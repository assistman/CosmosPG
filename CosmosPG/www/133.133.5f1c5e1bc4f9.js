(window.webpackJsonp=window.webpackJsonp||[]).push([[133],{2564:function(t,e,i){"use strict";i.r(e);var n=i(0),a=i.n(n),r=i(1),o=i(51),s=i(28),d=i.n(s),c=i(12),l=i.n(c),h=i(2447),u=i(8),v=i.n(u),g=i(74),m=i(40),p=i(14),f=i.n(p),y=i(1196),b=i(80),_=i.n(b),C=i(2557),S=i(9),w=i.n(S),O=i(2266),W=i(2572),E=i(60),I=i(2558),L=i(2559),T=i(34),k=i.n(T),j=i(10),x=i.n(j),D=i(57),P=i(2560),A=i.n(P),N=(i(2561),i(2448)),M=i(2562),V=i(2),z=i(7),B=i.n(z),R=i(109),Y=i(2449),J=i(46),U=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},H=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();function F(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}var K=500,q=[];L.widget.prototype.documentElement=function(){return this._innerWindow().document.documentElement},L.widget.prototype.forEachChart=function(t){for(var e=0,i=this._chartsCount;e<i;e++)t(this._innerAPI()._getChartWidgetApi(this._innerAPI()._chartWidgetCollection.getAll()[e]),e)};var G=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return l()(i),i.save=r.debounce(i.save,1e3),i.state={ready:!1,minimized:g.default.mobile()&&g.default.portrait()&&window.innerHeight<K,sidebarCollapsed:!1},i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),H(e,[{key:"componentDidMount",value:function(){this._mounted=!0;var t=this.props,e=t.client_id,i=t.user_id;x.a.getTradingViewSavedCharts(e,i).then(this.onSavedChartsLoaded).catch(this.onSavedChartsLoaded)}},{key:"onSavedChartsLoaded",value:function(t){var i=t.data,n=t.status;if(this.serverError=200!==n,this.serverError){var a=localStorage.getItem("tv_mc_local");a?this.onSavedChartLoaded(e.prepareLocalSavedChart(a)):this.initTradingViewWidget()}else if(i.data&&0!==i.data.length){var o=r.chain(i.data).filter((function(t){return 0===t.name.indexOf("multicharts")})).sortBy("timestamp").value();if(r.isEmpty(o))this.initTradingViewWidget();else{var s=this.props,d=s.client_id,c=s.user_id;r.each(r.initial(o),(function(t){return x.a.deleteTradingViewSavedChart(d,c,t.id)})),x.a.getTradingViewSavedChart(d,c,r.last(o).id).then(this.onSavedChartLoaded)}}else this.initTradingViewWidget()}},{key:"onSavedChartLoaded",value:function(t){var e=t.data.data,i=e.id,n=e.name,a=e.content;try{for(var r=JSON.parse(a),o=JSON.parse(r.content),s=o.charts,d=s.length-1;d>=0;d--){var c=s[d];delete c.timezone;for(var l=c.panes,h=l.length-1;h>=0;h--){for(var u=l[h],v=u.sources,g=v.length-1;g>=0;g--){var m=v[g];q.indexOf(m.state.description)>=0&&v.splice(g,1)}u.sources.length||l.splice(h,1)}}this.initTradingViewWidget(i,n.split("_")[1],o)}catch(t){this.initTradingViewWidget()}}},{key:"initTradingViewWidget",value:function(t,i,n,a){var o=this;this._mounted&&(this.chartId=t,this.theme=_.a.isLightTheme()?O.i.LIGHT:O.i.DARK,this.themeChanged=i!==this.theme,this.tvDatafeed=new C.b,this.tvDatafeed.on(C.a.LOAD,this.onDataLoaded),this.tvWidget=new L.widget(U({},this.props,{symbol:e.getSelectedInstrumentSymbol(),container_id:this.refs.tvWidget.id,datafeed:this.tvDatafeed,theme:this.theme,overrides:U({},O.d[this.theme],a&&{"mainSeriesProperties.style":a}),studies_overrides:O.g[this.theme],loading_screen:{backgroundColor:O.b[this.theme]}},m.default.mobile()&&{disabled_features:[].concat(F(this.props.disabled_features),F(O.a.MOBILE.DISABLED))},{enabled_features:[].concat(F(this.props.enabled_features),["header_layouttoggle","support_multicharts","header_symbol_search"])},n&&{saved_data:n},!n&&{interval:e.getDeepLinkInterval()||this.props.interval})),this.tvEventsListener=h.a.create({onThemeChanged:function(t){o.theme=t,o.changeTheme(t),o.tvWidget.forEachChart((function(e){r.each(e._positions,(function(e){return e.changeTheme(t)})),r.each(e._orders,(function(e){return e.changeTheme(t)}))}))},onInstrumentRowSelected:function(t,e){e&&(o.state.ready?t!==o.tvWidget.activeChart().symbol()&&o.setSymbol(t):o.tempSymbol=t)}}),this.tvWidget.onChartReady(this.onChartReady))}},{key:"onDataLoaded",value:function(t,i,n){var a=this;this.tvWidget.forEachChart((function(t,r){t.symbol()===i&&t.resolution()===n&&e.initTradings(a.tvDatafeed.getSubscription(i,n).getInstrument(),t,a.theme)}))}},{key:"onChartReady",value:function(){var t=this,i=this.tvWidget,n=i.documentElement();if(Object(O.l)(i,"multi-chart"),Object(O.m)(i),this.themeChanged&&this.changeTheme(this.theme),Object(O.k)(n),i.createButton({align:"right"}).attr("title",__("actions.close")).on("click",(function(t){var e=d.a.history.fragment;store.dispatch(Object(J.setMultiChartsEnabled)(!1)),B.a.navigate(e.substr(V.MULTI_CHARTS_PATH.length),{trigger:!1})})).append('<div class="close-mc"></div>'),m.default.mobile()&&(Object(O.j)(n),this.initOrientationHandler()),this.chartId){var a=this.getChartWidgetCollection().metaInfo,r=a.uid,o=a.id,s=a.name;o.setValue(this.chartId),r.setValue(this.chartId),s.setValue("multicharts")}else i.setLayout("4");i._chartsCount=this.tvWidget.chartsCount(),i.onContextMenu(this.onContextMenu),this.setState({ready:!0}),Object(I.b)(store.getState(),!0)===N.b.INDICATORS&&n.querySelector("#header-toolbar-indicators").click(),i.subscribe("onAutoSaveNeeded",(function(){t.save()})),i.subscribe("toggle_sidebar",(function(e){t.setState({sidebarCollapsed:e})})),i.subscribe("layout_about_to_be_changed",(function(){t.tvWidget.forEachChart((function(i){e.removeTradings(t.getInstrument(i.symbol()),i)}))})),i.subscribe("layout_changed",(function(){t.tvWidget._chartsCount=t.tvWidget.chartsCount(),Object(O.m)(t.tvWidget),t.tvWidget.forEachChart((function(i){i.dataReady((function(){return e.initTradings(t.getInstrument(),i,t.theme)}))}))})),this.tempSymbol&&(this.setSymbol(this.tempSymbol),delete this.tempSymbol),i.forEachChart((function(i,n){i.onSymbolChanged().subscribe(null,(function(){e.removeTradings(t.getInstrument(),i),t.save()})),i.onIntervalChanged().subscribe(null,(function(){t.save()}))}))}},{key:"getChartWidgetCollection",value:function(){return this.tvWidget._innerAPI()._chartWidgetCollection}},{key:"getInstrument",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.tvWidget.symbolInterval().symbol;return k.a.getInstrumentBySymbol(t)}},{key:"onContextMenu",value:function(t,i){if(i){var n=this.tvWidget.symbolInterval(),a=n.symbol,r=n.interval,o=this.tvDatafeed.getSubscription(a,r);if(o){var s=o.getLastCandle().close,d=o.getInstrument(),c=d.getDisplayName(),l=d.getPrecision(),h=i.toFixed(l),u=[],v=Object(D.h)(a),g=Object(D.m)(a);return+h<s?(v&&u.push({position:"top",text:__("actions.buy")+" "+c+" "+__("type.LIMIT")+" "+h,click:function(){e.trade(a,{direction:V.BUY,type:R.TYPE_LIMIT,entry:h})}}),g&&u.push({position:"top",text:__("actions.sell")+" "+c+" "+__("type.STOP")+" "+h,click:function(){e.trade(a,{direction:V.SELL,type:R.TYPE_STOP,entry:h})}})):+h>s&&(g&&u.push({position:"top",text:__("actions.sell")+" "+c+" "+__("type.LIMIT")+" "+h,click:function(){e.trade(a,{direction:V.SELL,type:R.TYPE_LIMIT,entry:h})}}),v&&u.push({position:"top",text:__("actions.buy")+" "+c+" "+__("type.STOP")+" "+h,click:function(){e.trade(a,{direction:V.BUY,type:R.TYPE_STOP,entry:h})}})),v&&u.push({position:"top",text:__("actions.buy")+" "+c+" "+__("type.MARKET"),click:function(){e.trade(a,{direction:V.BUY})}}),g&&u.push({position:"top",text:__("actions.sell")+" "+c+" "+__("type.MARKET"),click:function(){e.trade(a,{direction:V.SELL})}}),u.length>0&&u.push({text:"-",position:"top"}),u}}}},{key:"onOrientationChanged",value:function(){g.default.portrait()?this.tvWidget.documentElement().classList.replace("mobile-portrait","mobile-landscape"):this.tvWidget.documentElement().classList.replace("mobile-landscape","mobile-portrait")}},{key:"initOrientationHandler",value:function(){var t=this.onOrientationChanged,e=Object.prototype.hasOwnProperty.call(window,"onorientationchange")?"orientationchange":"resize";window.addEventListener?window.addEventListener(e,t,!1):window.attachEvent?window.attachEvent(e,t):window[e]=t,this.tvWidget.documentElement().classList.add(g.default.landscape()?"mobile-landscape":"mobile-portrait")}},{key:"save",value:function(){var t=this;this.tvWidget&&(this.serverError?this.tvWidget.save((function(e){localStorage.setItem("tv_mc_local",JSON.stringify({name:t.getChartName(),content:JSON.stringify({content:JSON.stringify(e)})}))})):this.tvWidget.saveChartToServer((function(){}),(function(){}),!1,{chartName:this.getChartName()}))}},{key:"getChartName",value:function(){return"multicharts_"+this.theme}},{key:"changeTheme",value:function(t){this.tvWidget.changeTheme(t),this.tvWidget.applyOverrides(O.d[t]),this.tvWidget.applyStudiesOverrides(O.g[t])}},{key:"componentWillUnmount",value:function(){this.destroy()}},{key:"destroy",value:function(){var t=this;this._mounted=!1,this.tvEventsListener&&(this.tvEventsListener.destroy(),this.tvEventsListener=null),this.tvDatafeed&&(this.tvDatafeed.destroy(),this.tvDatafeed=null),this.tvTradingCentral&&(this.tvTradingCentral.destroy(),this.tvTradingCentral=null),this.tvWidget&&(this.tvWidget.forEachChart((function(i){e.removeTradings(t.getInstrument(i.symbol()),i)})),this.tvWidget._getIFrameElement()&&!this.tvWidget._getIFrameElement().contentWindow.ChartApiInstance&&(this.tvWidget._getIFrameElement().contentWindow.ChartApiInstance={destroy:function(){}}),this.tvWidget._getIFrameElement()&&!this.tvWidget._getIFrameElement().contentWindow.destroyChart&&(this.tvWidget._getIFrameElement().contentWindow.destroyChart=function(){}),this.tvWidget.remove(),this.tvWidget=null)}},{key:"minimize",value:function(){this.setState({minimized:!0})}},{key:"restoreSize",value:function(){this.setState({minimized:!1})}},{key:"changeInterval",value:function(t){this.tvWidget.setSymbol(this.tvWidget.symbolInterval().symbol,O.e[t])}},{key:"render",value:function(){var t,e,i,n=this.state,o=n.ready,s=n.minimized,d=this.props,c=d.height,l=d.className,h=v()((i=!!l,(e=l)in(t={"chart-box":!0,"chart-trading-view":!0,minimized:s})?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t)),u={};return c&&(u={height:c+"px",minHeight:c+"px",maxHeight:c+"px"}),a.a.createElement("div",{className:h,style:u},a.a.createElement("div",{className:"multi-charts-trading-view-wrapper"},!o&&a.a.createElement(Y.a,null),a.a.createElement("div",{id:r.uniqueId("chart-trading-view-"),ref:"tvWidget",className:"chart-trading-view-container hidden-minimized"})))}},{key:"setSymbol",value:function(t){this.getChartWidgetCollection().lock.symbol.value()?this.tvWidget.forEachChart((function(e){return e.setSymbol(t)})):this.tvWidget.activeChart().setSymbol(t)}}],[{key:"getSelectedInstrumentSymbol",value:function(){return Object(E.getUiSelectedInstrumentCategorySymbol)(store.getState())}},{key:"getDeepLinkInterval",value:function(){if(Object(I.b)(store.getState(),!0)===N.b.DETAILS){var t=Object(I.a)(store.getState());if(t)return O.e[t.toLowerCase()]}}},{key:"prepareLocalSavedChart",value:function(t){var e=JSON.parse(t);return e.name?{data:{data:e}}:{data:{data:{name:"",content:JSON.stringify({content:t})}}}}},{key:"trade",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.direction===V.BUY&&Object(D.h)(t)?B.a.trigger("ui:new-position",U({symbolOrId:t},e)):e.direction===V.SELL&&Object(D.m)(t)&&B.a.trigger("ui:new-position",U({symbolOrId:t},e))}},{key:"initTradings",value:function(t,i,n){f.a.isChartTradingViewTradingLinesEnabled()&&(i._eventsListener||(i._eventsListener=r.extend({},d.a.Events)),i._eventsListener.listenTo(t.getPositions(),"add",(function(e){i._positions.push(Object(M.b)(i,t,e,n))})),i._eventsListener.listenTo(t.getOrders(),"add",(function(e){i._orders.push(Object(M.a)(i,t,e,n))})),e.initPositions(t,i,n),e.initOrders(t,i,n))}},{key:"removeTradings",value:function(t,e){e._eventsListener&&(e._eventsListener.stopListening(t.getPositions(),"add"),e._eventsListener.stopListening(t.getOrders(),"add"),delete e._eventsListener),e._positions&&(r.each(e._positions,(function(t){return t.remove()})),delete e._positions),e._orders&&(r.each(e._orders,(function(t){return t.remove()})),delete e._orders)}},{key:"initOrders",value:function(t,e,i){e._orders||(e._orders=[]),r.each(t.getOrders().models,(function(n){e._orders.push(Object(M.a)(e,t,n,i))}))}},{key:"initPositions",value:function(t,e,i){e._positions||(e._positions=[]),r.each(t.getPositions().models,(function(n){e._positions.push(Object(M.b)(e,t,n,i))}))}}]),e}(a.a.Component);G.defaultProps={autosize:!0,disabled_features:O.a.DISABLED,enabled_features:O.a.ENABLED,interval:"5",library_path:"tv/",locale:o.getCurrentLanguage()||"en",charts_storage_url:x.a.tradingViewService(),client_id:Object(y.default)(f.a.getBrandName()),user_id:Object(y.default)(w.a.getCustomerId()),charts_storage_api_version:"1.1",auto_save_delay:1,link_to_tradingview:!1,timezone:Object(W.a)(w.a.getUserCommonData().getUserTimezoneObject()),custom_css_url:""+window.location.origin+window.location.pathname+"/"+A.a,time_frames:[{text:"1d",resolution:"1",description:"1 Day"},{text:"5d",resolution:"5",description:"5 Days"},{text:"1m",resolution:"30",description:"1 Month"},{text:"3m",resolution:"60",description:"3 Months"},{text:"6m",resolution:"120",description:"6 Months"},{text:"1y",resolution:"D",description:"1 Year"},{text:"5y",resolution:"W",description:"5 Years"}]},e.default=G}}]);