(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{2196:function(e,t,r){(function(o){var n,i=function(){function e(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,r,o){return r&&e(t.prototype,r),o&&e(t,o),t}}();void 0===(n=function(e,t,o){var n=r(1),s=r(11),u=r(695),c=r(70),a=r(10),d=r(1236),f=r(1237),l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return i(e,null,[{key:"initEditing",value:function(t,r,o,n){var i=n.onChangeProfitForTakeProfit,s=n.onChangeLossForStopLoss,u=n.onChangeRate,c=n.onChangeConversionRate;c&&t.listenTo(r,"change:conversionRate",c),u&&t.listenTo(r,"change:rate",u),i&&t.listenTo(r,"change:profitForTakeProfit",i),s&&t.listenTo(r,"change:lossForStopLoss",s),o&&e.sendSubscribeToConversion(r.getInstrument().getCurrency(),a.getUserCurrency())}},{key:"createEditPositionModel",value:function(e,t){var r=e.get("quantity")<0?"Sell":"Buy";return new d({instrumentModel:t,type:r,direction:r,position:e})}},{key:"stopEditing",value:function(t,r,o){t.stopListening(r),o&&e.sendUnsubscribeFromConversion(r.getInstrument().getCurrency(),a.getUserCurrency())}},{key:"sendSubscribeToConversion",value:function(t,r){return u.add(t,r).then(e.requestConversionSubscriptionSuccess).catch(e.requestConversionSubscriptionError)}},{key:"sendUnsubscribeFromConversion",value:function(t,r){return u.remove(t,r).then(e.requestConversionUnsubscriptionSuccess).catch(e.requestConversionUnsubscriptionError)}},{key:"requestConversionSubscriptionSuccess",value:function(e){return Promise.resolve(e)}},{key:"requestConversionSubscriptionError",value:function(e){return Promise.reject(e)}},{key:"requestConversionUnsubscriptionSuccess",value:function(e){return Promise.resolve(e)}},{key:"requestConversionUnsubscriptionError",value:function(e){return Promise.reject(e)}},{key:"removePositionStopLoss",value:function(t){return e.requestEditPosition(t,["takeProfit"]).then(e.onSubmitSuccess).catch(e.onSubmitError)}},{key:"removePositionTakeProfit",value:function(t){return e.requestEditPosition(t,["stopLoss"]).then(e.onSubmitSuccess).catch(e.onSubmitError)}},{key:"removeOrderStopLoss",value:function(t){return e.requestPlaceOrder(t,["takeProfit"]).then(e.onSubmitSuccess).catch(e.onSubmitError)}},{key:"removeOrderTakeProfit",value:function(t){return e.requestPlaceOrder(t,["stopLoss"]).then(e.onSubmitSuccess).catch(e.onSubmitError)}},{key:"requestEditPosition",value:function(e,t){var r=[];if(t.indexOf("takeProfit")>=0&&e.getPositionModel().get("takeProfit")){var o={fixedOffset:e.minOrderDistance(),fixedPrice:e.getTakeProfit(),isPriceFixed:!0,orderType:"LIMIT",requestId:null};r.push(o)}if(t.indexOf("stopLoss")>=0&&e.getPositionModel().get("stopLoss")){var n={fixedOffset:e.minOrderDistance(),fixedPrice:e.getStopLoss(),isPriceFixed:!0,orderType:"STOP",requestId:null};r.push(n)}return s.editPosition(c.getAtmosphereId(),r,e.getPositionCode())}},{key:"onSubmitSuccess",value:function(){return Promise.resolve()}},{key:"onSubmitError",value:function(){return Promise.reject(res)}},{key:"getOrderAttributes",value:function(e,t){var r=e.get("quantity"),o=r>0?"buy":"sell",n=e.get("type"),i=null,s=null,u=e.get("takeProfit"),c=e.get("stopLoss");switch(n){case"STOP":n="Entry Stop",s="buy"===o?"above":"below",i=e.get("stopPrice");break;case"LIMIT":n="Entry Limit",s="buy"===o?"below":"above",i=e.get("limitPrice")}return{instrument:t,order:e,action:o,quantity:Math.abs(r),type:n,orderPosition:s,price:i,takeProfit:u&&u.fixedPrice,stopLoss:c&&c.fixedPrice}}},{key:"createEditOrderModel",value:function(t,r){var o=e.getOrderAttributes(t,r);return new f({instrumentModel:o.instrument,type:o.action,direction:o.action.toUpperCase(),order:o.order,takeProfit:o.takeProfit,stopLoss:o.stopLoss})}},{key:"requestPlaceOrder",value:function(e,t){var r={effect:"OPENING",instrumentId:e.getInstrumentModel().getId(),orderSide:e.getDirection(),orderType:e.order.getType(),quantity:e.getAmount(),refOrderChainId:e.order.getOrderChainId(),requestId:n.uniqueId("gwt-uid-"),timeInForce:"GTC"};return e.order.isLimitPrice()?(r.limitPrice=e.getCurrentPrice(),r.stopPrice=null):(r.limitPrice=null,r.stopPrice=e.getCurrentPrice()),t.indexOf("stopLoss")>=0&&e.order.get("stopLoss")&&(r.stopLoss={fixedOffset:e.minOrderDistance(!1),fixedPrice:e.getStopLoss(),isPriceFixed:!0,orderType:"STOP"}),t.indexOf("takeProfit")>=0&&e.order.get("takeProfit")&&(r.takeProfit={fixedOffset:e.minOrderDistance(!1),fixedPrice:e.getTakeProfit(),isPriceFixed:!0,orderType:"LIMIT"}),e.order.unset("modifiedTime",{silent:!0}),s.placeOrder(c.getAtmosphereId(),r)}},{key:"updatePositionTakeProfit",value:function(t){return e.updatePosition(t)}},{key:"updatePositionStopLoss",value:function(t){return e.updatePosition(t)}},{key:"updatePosition",value:function(t){return e.requestEditPosition(t,["takeProfit","stopLoss"]).then(e.onSubmitSuccess).catch(e.onSubmitError)}},{key:"updateOrderTakeProfit",value:function(t){return e.updateOrder(t)}},{key:"updateOrderStopLoss",value:function(t){return e.updateOrder(t)}},{key:"updateOrder",value:function(t){return e.requestPlaceOrder(t,["takeProfit","stopLoss"]).then(e.onSubmitSuccess).catch(e.onSubmitError)}}]),e}();o.exports=l}.call(t,r,t,e))||(e.exports=n)}).call(this,r(1))}}]);