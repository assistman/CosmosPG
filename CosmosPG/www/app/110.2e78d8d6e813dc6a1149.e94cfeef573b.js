(window.webpackJsonp=window.webpackJsonp||[]).push([[110],{1934:function(e,t,n){"use strict";n.r(t),function(e){var o=n(149),a=n(310),r=n(41),i=n(2094),s=n(0),u=n.n(s),l=n(15),c=n.n(l),p=n(4),m=n(2172),f=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var d=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return c()(n),n.state={isBacktestReady:!!e.backtest,shouldRunBacktest:!e.backtest,createdBacktest:e.backtest},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),f(t,[{key:"onBacktestRunnerSuccess",value:function(e){this.setState({isBacktestReady:!0,shouldRunBacktest:!1,createdBacktest:e})}},{key:"render",value:function(){var e=this.state,t=e.shouldRunBacktest,n=e.isBacktestReady,r=e.createdBacktest,s=this.props,l=s.portfolio,c=s.onErrorCancel,p=s.onErrorClose,f=s.onClose,d=s.onSuccess,_=s.onCancel;return u.a.createElement(u.a.Fragment,null,t&&u.a.createElement(a.b,null,u.a.createElement(o.a,{position:"absolute",fit:!0})),t&&u.a.createElement(i.a,{filters:l&&l.filters,onSuccess:this.onBacktestRunnerSuccess,onErrorCancel:c,onErrorClose:p}),n&&u.a.createElement(m.a,{portfolioName:l&&l.portfolioName,backtest:r,onSuccess:d,onClose:f,onCancel:_,onErrorClose:p,onErrorCancel:c}))}}]),t}(u.a.Component);d.defaultProps={onClose:e.noop,onSuccess:e.noop,onCancel:e.noop,onErrorClose:e.noop,onErrorCancel:e.noop,backtest:null},t.default=Object(p.connect)((function(e,t){var n=t.portfolioName;return{portfolio:Object(r.T)(e,n)}}))(d)}.call(this,n(1))},2172:function(e,t,n){"use strict";var o=n(3),a=n(647),r=n(648),i=n(149),s=n(310),u=n(230),l=n(5),c=n.n(l),p=n(2173),m=n(123),f=n(13),d=n(0),_=n.n(d),h=n(15),b=n.n(h),v=n(515),E=n(875),y=n(877),k=n(876),g=n(1),C=n.n(g),N=n(6),S=n.n(N),O=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var w=function(e){var t=e.input,n=t.value,o=t.onChange,i=t.onBlur,s=t.onFocus,u=t.name,l=e.className,c=e.step,p=e.meta.error;return _.a.createElement("div",{className:l},_.a.createElement(r.a,{name:u,type:"text",className:"form-control input-field",value:n,onChange:o,onFocus:s,onBlur:i,error:!!p,errorMessage:p}),_.a.createElement(a.a,{onPlusClick:function(){return o(n&&Number(n)-c>-1?Number(n)+c:c)},onMinusClick:function(){return o(n&&Number(n)-c>-1?Number(n)-c:0)}}))},A=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={minAmount:0,statusOfAmountLoader:o.LOADING,maxAmount:0,defaultAmount:0,statusOfBuilding:o.EMPTY,shouldLoadAmount:!0},n.amountLoaderRef=_.a.createRef(),b()(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),O(t,[{key:"componentDidMount",value:function(){var e=this.props.defaultAmount();this._mounted=!0,this.inputStep=this.props.getStepIncrement(e),this.props.change("amount",e)}},{key:"componentWillUnmount",value:function(){this._mounted=!1}},{key:"componentWillUpdate",value:function(e){this.props.change("portfolioName",e.portfolioName),this.props.change("backtestID",e.backtest&&e.backtest.backtest.backtestID)}},{key:"mounted",value:function(){return this._mounted}},{key:"onLoadMinAmountSuccess",value:function(e){this.props.defaultAmount()<e&&this.props.change("amount",e),this.setState({minAmount:e,statusOfAmountLoader:o.SUCCESS,shouldLoadAmount:!1})}},{key:"tryLoadAmountAgain",value:function(){this.amountLoaderRef.current.load()}},{key:"getCommonData",value:function(){return{minAmount:this.state.minAmount,freeMargin:S.a.getUserAccountMetricsModel().getBuyingPower()}}},{key:"onBuildPortfolioSuccess",value:function(e){return this.props.onSuccess(e),e}},{key:"onBuildPortfolioError",value:function(){this.setState({statusOfBuilding:o.ERROR})}},{key:"onErrorBuildingCancel",value:function(){this.setState({statusOfBuilding:o.EMPTY})}},{key:"onErrorBuildingClose",value:function(){this.setState({statusOfBuilding:o.EMPTY})}},{key:"trySubmitAgain",value:function(){this.props.dispatch(Object(v.e)(this.props.form))}},{key:"validateAmount",value:function(e){var t=this.state.minAmount,n=this.getCommonData().freeMargin;return e<t?__("portfolio.amount.popup.error.amount_less_minimum",t):e>n||n<t?_.a.createElement("span",{key:"insufficient-funds"},__("portfolio.amount.popup.error.insufficient_funds"),_.a.createElement("a",{className:"cursor--pointer",onClick:function(){return c.a.trigger("ui:deposit")}},__("portfolio.amount.popup.error.add_funds"))):void 0}},{key:"validateTakeProfit",value:function(e,t,n){n.syncErrors}},{key:"validateStopLoss",value:function(e,t,n){var o=n.syncErrors,a=this.getCommonData(),r=a.freeMargin,i=(a.minAmount,Number(t.amount)),s=o&&o.amount?r:i;if(e=Number(e),!C.a.isNaN(e))return e>s-1?__("portfolio.errors.stopLoss.too_high",s-1):void 0}},{key:"submit",value:function(e,t,n){var o=e.amount,a=e.takeProfit,r=e.stopLoss,i=e.portfolioName,s=this.props.backtest&&this.props.backtest.backtest;return n.clearSubmitErrors(),n.startSubmit(),t(Object(m.a)(i,s,null,null,o,a,r,{autoDeleteLocalPortfolio:!1})).then((function(e){return n.setSubmitSucceeded(),e})).then(C.a.callIf(this.onBuildPortfolioSuccess,this.mounted)).then((function(e){return t(Object(m.e)(e.strategyName)),e})).catch((function(){return n.setSubmitFailed(),Promise.reject()})).catch(C.a.callIf(this.onBuildPortfolioError,this.mounted)),!1}},{key:"render",value:function(){var e=this.props,t=e.backtest,n=e.portfolioName,a=e.invalid,r=e.onClose,l=e.handleSubmit,c=e.submitting,m=e.submitFailed,f=e.onErrorCancel,d=e.onErrorClose,h=e.normalizeNumber,b=S.a.getUserCurrency(),v=this.state,k=v.shouldLoadAmount,g=v.statusOfAmountLoader;return m?_.a.createElement(u.a,{title:__("errors.title"),message:__("server.request.generic.error.body",__("funded.client.contact_us.link")),textOK:__("actions.try_again"),onOK:this.trySubmitAgain,onCancel:r,onClose:r}):g===o.ERROR?_.a.createElement(u.a,{title:__("errors.title"),message:__("server.request.generic.error.body",__("funded.client.contact_us.link")),textOK:__("actions.try_again"),onOK:this.tryLoadAmountAgain,onCancel:r,onClose:r}):_.a.createElement(s.b,{popupStyle:"quant",onClose:r,title:__("portfolio.amount.popup.title")+" - "+n},_.a.createElement(s.a,null,c&&_.a.createElement(i.a,{position:"absolute",fit:!0}),m&&_.a.createElement(u.a,{title:__("errors.title"),message:__("server.request.generic.error.body",__("funded.client.contact_us.link")),textOK:__("actions.try_again"),onOK:this.buildPortfolio,onCancel:this.onErrorBuildingCancel,onClose:this.onErrorBuildingClose}),_.a.createElement(E.a,{autoComplete:"off",onSubmit:l(this.submit),className:"form form__amount pane pane__fluid pane__column pane_padded-small pane--relative"},k&&_.a.createElement(p.a,{ref:this.amountLoaderRef,backtestOverviewPositions:t&&t.overview.lastPortfolioData.positions,portfolioName:n,onSuccess:this.onLoadMinAmountSuccess,onErrorCancel:f,onErrorClose:d}),_.a.createElement("div",{key:"invest-portfolio-form",className:"pane pane__fluid pane__column"},_.a.createElement(y.a,{name:"portfolioName",component:"input",type:"hidden"}),_.a.createElement("div",{className:"form-row"},_.a.createElement("div",{className:"pane pane__fluid fs-13 bold"},__("portfolio.amount.popup.amount")+" - "+b),_.a.createElement(y.a,{name:"amount",className:"pane",component:w,step:this.inputStep,validate:this.validateAmount,normalize:h})),_.a.createElement("div",{className:"form-row"},_.a.createElement("div",{className:"pane pane__fluid fs-13 pane__row flex-valign-center"},_.a.createElement("div",{className:"pane"},_.a.createElement("i",{className:"icon icon-information","aria-label":__("portfolio.amount.popup.tooltip.take_profit")})),_.a.createElement("div",{className:"pane pane__column pane__fluid"},_.a.createElement("div",null,__("portfolio.amount.popup.take_profit")),_.a.createElement("div",null,b))),_.a.createElement(y.a,{name:"takeProfit",className:"pane",component:w,step:this.inputStep,validate:this.validateTakeProfit,normalize:h})),_.a.createElement("div",{className:"form-row"},_.a.createElement("div",{className:"pane pane__fluid fs-13 pane__row flex-valign-center"},_.a.createElement("div",{className:"pane"},_.a.createElement("i",{className:"icon icon-information","aria-label":__("portfolio.amount.popup.tooltip.stop_loss")})),_.a.createElement("div",{className:"pane pane__column pane__fluid"},_.a.createElement("div",null,__("portfolio.amount.popup.stop_loss")),_.a.createElement("div",null,b))),_.a.createElement(y.a,{name:"stopLoss",className:"pane",component:w,step:this.inputStep,validate:this.validateStopLoss,normalize:h})),_.a.createElement(y.a,{name:"portfolioName",component:"input",type:"hidden",value:n})),_.a.createElement("div",{className:"pane pane__fluid pane__column"},_.a.createElement("div",{className:"pane pane__xfluid"},_.a.createElement("button",{className:"btn btn-primary pane pane__fluid flex-align-center",type:"submit",disabled:a||g!==o.SUCCESS},__("indigo.order.form.send_order")))))))}}]),t}(_.a.PureComponent);A.defaultProps={onSuccess:C.a.noop,onClose:C.a.noop},t.a=Object(k.a)({form:f.A,initialValues:{amount:0,portfolioName:""},defaultAmount:function(){return 100*parseInt(.3*S.a.getUserAccountMetricsModel().getBuyingPower()/100)},getStepIncrement:function(e){var t=parseInt(e/10/f.t)*f.t;return t>100?t:100},normalizeNumber:function(e,t){return C.a.isEmpty(e)?e:/^\d*\.?\d{0,2}$/gi.test(e)?e:t}})(A)}}]);