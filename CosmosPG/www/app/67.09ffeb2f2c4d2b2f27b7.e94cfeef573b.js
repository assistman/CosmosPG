(window.webpackJsonp=window.webpackJsonp||[]).push([[67],{1959:function(t,e,n){"use strict";n.r(e);var i=n(0),a=n.n(i),r=n(1),s=n.n(r),o=n(54),c=n(15),l=n.n(c),d=n(2255),h=n(7),u=n.n(h),m=n(71),v=n(33),g=n(134),p=n(9),f=n.n(p),y=n(976),b=n(72),_=n.n(b),C=n(2367),E=n(6),w=n.n(E),O=n(2064),S=n(2383),T=n(59),L=n(978),I=n(2368),W=n(26),k=n.n(W),j=n(8),N=n.n(j),D=n(49),P=n(2369),x=n.n(P),A=(n(2370),n(453)),z=n(2371),M=n(3),Y=n(5),V=n.n(Y),R=n(98),B=n(4),H=n(108),U=n.n(H),J=n(91),F=n.n(J),G=n(2),K=n(768),q=Object(G.a)([function(t){return t.tradingCentral},function(t,e,n){return e},function(t,e,n){return n}],(function(t,e,n){return t[Object(K.a)(e,n)]})),Q=Object(G.a)([q],(function(t){return t&&t.status})),X=Object(G.a)([q],(function(t){return t&&t.data})),Z=n(2256),$=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],i=!0,a=!1,r=void 0;try{for(var s,o=t[Symbol.iterator]();!(i=(s=o.next()).done)&&(n.push(s.value),!e||n.length!==e);i=!0);}catch(t){a=!0,r=t}finally{try{!i&&o.return&&o.return()}finally{if(a)throw r}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},tt=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();function et(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var nt=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),tt(e,[{key:"formatLegendLine",value:function(t,e){return F()(__(t),{preprocessNodes:function(t){return s.a.each(t,(function(t){"span"===t.name&&t.children&&(t.attribs={style:"color:"+e})})),t}})}},{key:"render",value:function(){var t=this.props.status;if(!t)return null;switch(t){case M.LOADING:var e=u()(et({"chart-trading-central tc":!0,"tc-loading":!0},this.props.className,!!this.props.className));return a.a.createElement("div",{className:e},a.a.createElement("div",{className:"tc-wrapper"},a.a.createElement(Z.a,null)));case M.ERROR:var n=u()(et({"chart-trading-central tc":!0,"tc-instrument-unavailable":!0},this.props.className,!!this.props.className));return a.a.createElement("div",{className:n},a.a.createElement("div",{className:"tc-wrapper"},__("trading.central.unavailable.description")));case M.SUCCESS:var i=this.props,r=i.data,o=i.settings,c=r.title,l=r.date,d=r.hour,h=r.paragraphs,m=r.term,v=r.pivot,g=r.resistance1,p=r.support1,f=$(o.lines,3),y=$(f[0].colors,1)[0],b=$(f[1].colors,1)[0],_=$(f[2].colors,1)[0],C=__("trading.central.preference.title")+" "+__("trading.central.term."+m.toLowerCase());v===g?C+=" "+__("trading.central.preference.decline"):v===p&&(C+=" "+__("trading.central.preference.rise"));var E=U.a.user.applyOffset(""+l+d,"YYYYMMDDHH:mm","DD/MM/YYYY HH:mm")+" ("+U.a.user.GMTPostfix()+")",w=u()(et({"chart-trading-central tc":!0},this.props.className,!!this.props.className));return a.a.createElement("div",{className:w},a.a.createElement("div",{className:"tc-wrapper"},a.a.createElement("div",{className:"tc-info"},a.a.createElement("div",{className:"tc-header"},C),a.a.createElement("div",null,c),s.a.map(h,(function(t,e){return a.a.createElement("div",{key:"tc-p-"+e},t)})),a.a.createElement("div",null,E)),a.a.createElement("div",{className:"tc-legend-full"},a.a.createElement("div",{className:"tc-header"},F()(__("trading.central.study.legend"))),a.a.createElement("div",{className:"tc-resistance"},this.formatLegendLine("trading.central.lines.extended.resistance",y)),a.a.createElement("div",{className:"tc-support"},this.formatLegendLine("trading.central.lines.extended.support",b)),a.a.createElement("div",{className:"tc-pivot"},this.formatLegendLine("trading.central.lines.extended.pivot",_)))))}}}]),e}(a.a.Component),it=Object(B.connect)((function(t,e){var n=e.symbol,i=e.term;return{data:X(t,n,i),status:Q(t,n,i),settings:w.a.getUserCommonData().getTradingCentralSettings()}}))(nt),at=n(2382),rt=n(972),st=n(521),ot=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},ct=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();function lt(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}var dt=500,ht=[at.a];I.widget.prototype.documentElement=function(){return this._innerWindow().document.documentElement},I.widget.prototype.forEachChart=function(t){for(var e=0,n=this.chartsCount();e<n;e++)t(this.chart(e),e)};var ut=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return l()(n),n.save=r.debounce(n.save,1e3),n.state={ready:!1,minimized:m.default.mobile()&&m.default.portrait()&&window.innerHeight<dt,sidebarCollapsed:!1},n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),ct(e,[{key:"componentDidMount",value:function(){this._mounted=!0,this.symbol=this.props.symbol||e.getSelectedInstrumentSymbol(),st.traceAdvancedChartLoad.start({onCategoryChange:!0});var t=this.props,n=t.client_id,i=t.user_id;N.a.getTradingViewSavedCharts(n,i).then(this.onSavedChartsLoaded).catch(this.onSavedChartsLoaded)}},{key:"onSavedChartsLoaded",value:function(t){var n=t.data,i=t.status;if(this.serverError=200!==i,this.serverError){var a=localStorage.getItem("tv_local");a?this.onSavedChartLoaded(e.prepareLocalSavedChart(a)):this.initTradingViewWidget()}else if(n.data&&0!==n.data.length){var s=r.chain(n.data).filter((function(t){return 0===t.name.indexOf("main")})).sortBy("timestamp").value();if(r.isEmpty(s))this.initTradingViewWidget();else{var o=this.props,c=o.client_id,l=o.user_id;r.each(r.initial(s),(function(t){return N.a.deleteTradingViewSavedChart(c,l,t.id)})),N.a.getTradingViewSavedChart(c,l,r.last(s).id).then(this.onSavedChartLoaded)}}else this.initTradingViewWidget()}},{key:"onSavedChartLoaded",value:function(t){var n=t.data.data,i=n.id,a=n.name,r=n.content;try{var s=JSON.parse(r),o=JSON.parse(s.content);f.a.isChartTradingViewMultichartsEnabled()||(o.layout="s");for(var c=o.charts,l=c.length-1;l>=0;l--){var d=c[l];delete d.timezone;for(var h=d.panes,u=h.length-1;u>=0;u--){for(var m=h[u],v=m.sources,g=v.length-1;g>=0;g--){var p=v[g];if("MainSeries"===p.type&&(p.state.symbol=this.symbol,0===l)){var y=e.getDeepLinkInterval();y&&(p.state.interval=y),O.f[p.state.interval]||(p.state.interval=this.props.interval)}ht.indexOf(p.state.description)>=0&&v.splice(g,1)}m.sources.length||h.splice(u,1)}}this.initTradingViewWidget(i,a.split("_")[1],o)}catch(t){this.initTradingViewWidget()}}},{key:"initTradingViewWidget",value:function(t,n,i,a){var s=this;this._mounted&&(this.chartId=t,this.theme=_.a.isLightTheme()?O.i.LIGHT:O.i.DARK,this.themeChanged=n!==this.theme,this.tvDatafeed=new C.b,this.tvDatafeed.on(C.a.LOAD,this.onDataLoaded),this.tvWidget=new I.widget(ot({},this.props,{symbol:this.symbol,container_id:this.refs.tvWidget.id,datafeed:this.tvDatafeed,theme:this.theme,overrides:ot({},O.d[this.theme],a&&{"mainSeriesProperties.style":a}),studies_overrides:O.g[this.theme],loading_screen:{backgroundColor:O.b[this.theme]}},v.default.mobile()&&{disabled_features:[].concat(lt(this.props.disabled_features),lt(O.a.MOBILE.DISABLED))},f.a.isChartTradingViewMultichartsEnabled()&&{enabled_features:[].concat(lt(this.props.enabled_features),["header_layouttoggle","support_multicharts"])},i&&{saved_data:i},!i&&{interval:e.getDeepLinkInterval()||this.props.interval})),this.tvTradingCentral=new at.b(this.tvWidget),this.tvEventsListener=d.a.create({onThemeChanged:function(t){s.theme=t,s.changeTheme(t),r.each(s.positions,(function(e){return e.changeTheme(t)})),r.each(s.orders,(function(e){return e.changeTheme(t)}))},onInstrumentRowSelected:function(t){s.state.ready?t!==s.symbol&&s.setSymbol(t):s.tempSymbol=t}}),this.tvEventsListener.listenTo(V.a,rt.TC_SETTINGS_UPDATE_EVENT,this.onTradingCentralStatusChanged),this.tvWidget.onChartReady(this.onChartReady))}},{key:"setSymbol",value:function(t){var e=this;st.traceAdvancedChartLoad.start({onCategoryChange:!1}),this.symbol=t,this.removeTradings(this.getInstrument()),this.removeTradingCentral(),this.tvWidget.forEachChart((function(n){return n.setSymbol(t,(function(){return e.save()}))}))}},{key:"onDataLoaded",value:function(t,e,n){var i=this;if(e===this.symbol){var a=this.tvDatafeed.getSubscription(e,n).getInstrument();this.tvWidget.forEachChart((function(t,e){t.resolution()===n&&t.dataReady((function(){i.initTradings(a,t),0===e&&i.initTradingCentral(a,n,t)}))})),st.traceAdvancedChartLoad.stop({symbol:this.symbol,period:this.state.period}),st.tracePlatformLoad.stop(),st.tracePlatformLogin.record()}}},{key:"onChartReady",value:function(){var t=this,e=this.tvWidget.documentElement(),n=this.tvWidget.chart();Object(O.l)(this.tvWidget,"main-chart"),Object(O.m)(this.tvWidget),Object(O.n)(this.tvWidget),this.themeChanged&&this.changeTheme(this.theme),Object(O.k)(e),this.updateIntervalDropdown(),v.default.mobile()&&(Object(O.j)(e),this.initOrientationHandler()),this.chartId&&(this.tvWidget._innerAPI()._chartWidgetCollection.metaInfo.id.setValue(this.chartId),this.tvWidget._innerAPI()._chartWidgetCollection.metaInfo.uid.setValue(this.chartId),this.tvWidget._innerAPI()._chartWidgetCollection.metaInfo.name.setValue("main")),this.tvWidget.onContextMenu(this.onContextMenu),this.setState({ready:!0}),Object(L.getDeepLinkPath)(store.getState(),!0)===A.PATH.INDICATORS&&e.querySelector("#header-toolbar-indicators").click(),this.tvWidget.subscribe("onAutoSaveNeeded",(function(){t.save()})),n.onSymbolChanged().subscribe(null,(function(){t.save()})),n.onIntervalChanged().subscribe(null,(function(){t.save(),t.updateIntervalDropdown()})),this.tvWidget.subscribe("toggle_sidebar",(function(e){t.setState({sidebarCollapsed:e})})),this.tvWidget.subscribe("layout_changed",(function(){Object(O.m)(t.tvWidget),Object(O.n)(t.tvWidget),t.removeTradings(t.getInstrument()),t.tvWidget.forEachChart((function(e,n){e.dataReady((function(){return t.initTradings(t.getInstrument(),e)})),n>0&&t.tvTradingCentral.remove(e)}))})),this.tempSymbol&&(this.setSymbol(this.tempSymbol),delete this.tempSymbol)}},{key:"getInstrument",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.tvWidget.symbolInterval().symbol;return k.a.getInstrumentBySymbol(t)}},{key:"onContextMenu",value:function(t,n){if(n){var i=this.tvWidget.symbolInterval(),a=i.symbol,r=i.interval,s=this.tvDatafeed.getSubscription(a,r);if(s){var o=s.getLastCandle().close,c=s.getInstrument(),l=c.getDisplayName(),d=c.getPrecision(),h=n.toFixed(d),u=[],m=Object(D.isBuyTradable)(a),v=Object(D.isSellTradable)(a);return+h<o?(m&&u.push({position:"top",text:__("actions.buy")+" "+l+" "+__("type.LIMIT")+" "+h,click:function(){e.trade(a,{direction:M.BUY,type:R.TYPE_LIMIT,entry:h})}}),v&&u.push({position:"top",text:__("actions.sell")+" "+l+" "+__("type.STOP")+" "+h,click:function(){e.trade(a,{direction:M.SELL,type:R.TYPE_STOP,entry:h})}})):+h>o&&(v&&u.push({position:"top",text:__("actions.sell")+" "+l+" "+__("type.LIMIT")+" "+h,click:function(){e.trade(a,{direction:M.SELL,type:R.TYPE_LIMIT,entry:h})}}),m&&u.push({position:"top",text:__("actions.buy")+" "+l+" "+__("type.STOP")+" "+h,click:function(){e.trade(a,{direction:M.BUY,type:R.TYPE_STOP,entry:h})}})),m&&u.push({position:"top",text:__("actions.buy")+" "+l+" "+__("type.MARKET"),click:function(){e.trade(a,{direction:M.BUY})}}),v&&u.push({position:"top",text:__("actions.sell")+" "+l+" "+__("type.MARKET"),click:function(){e.trade(a,{direction:M.SELL})}}),u.length>0&&u.push({text:"-",position:"top"}),u}}}},{key:"updateIntervalDropdown",value:function(){this.setState({period:O.f[this.tvWidget.symbolInterval().interval]})}},{key:"onOrientationChanged",value:function(){m.default.portrait()?this.tvWidget.documentElement().classList.replace("mobile-portrait","mobile-landscape"):this.tvWidget.documentElement().classList.replace("mobile-landscape","mobile-portrait")}},{key:"initOrientationHandler",value:function(){var t=this.onOrientationChanged,e=Object.prototype.hasOwnProperty.call(window,"onorientationchange")?"orientationchange":"resize";window.addEventListener?window.addEventListener(e,t,!1):window.attachEvent?window.attachEvent(e,t):window[e]=t,this.tvWidget.documentElement().classList.add(m.default.landscape()?"mobile-landscape":"mobile-portrait")}},{key:"save",value:function(){var t=this;this.tvWidget&&(this.serverError?this.tvWidget.save((function(e){localStorage.setItem("tv_local",JSON.stringify({name:t.getChartName(),content:JSON.stringify({content:JSON.stringify(e)})}))})):this.tvWidget.saveChartToServer((function(){}),(function(){}),!1,{chartName:this.getChartName()}))}},{key:"getChartName",value:function(){return"main_"+this.theme}},{key:"changeTheme",value:function(t){this.tvWidget.changeTheme(t),this.tvWidget.applyOverrides(O.d[t]),this.tvWidget.applyStudiesOverrides(O.g[t])}},{key:"componentWillUnmount",value:function(){this._mounted=!1,this.tvEventsListener&&(this.tvEventsListener.destroy(),this.tvEventsListener=null),this.tvDatafeed&&(this.tvDatafeed.destroy(),this.tvDatafeed=null),this.tvTradingCentral&&(this.tvTradingCentral.destroy(),this.tvTradingCentral=null),r.each(this.positions,(function(t){return t.remove()})),r.each(this.orders,(function(t){return t.remove()})),this.tvWidget&&(this.tvWidget._getIFrameElement()&&!this.tvWidget._getIFrameElement().contentWindow.ChartApiInstance&&(this.tvWidget._getIFrameElement().contentWindow.ChartApiInstance={destroy:function(){}}),this.tvWidget._getIFrameElement()&&!this.tvWidget._getIFrameElement().contentWindow.destroyChart&&(this.tvWidget._getIFrameElement().contentWindow.destroyChart=function(){}),this.tvWidget.remove(),this.tvWidget=null)}},{key:"minimize",value:function(){this.setState({minimized:!0})}},{key:"restoreSize",value:function(){this.setState({minimized:!1})}},{key:"changeInterval",value:function(t){this.tvWidget.setSymbol(this.tvWidget.symbolInterval().symbol,O.e[t])}},{key:"render",value:function(){var t,e,n,i=this.state,s=i.ready,o=i.minimized,c=i.period,l=i.sidebarCollapsed,d=i.tradingCentral,h=this.props,m=h.height,p=h.className,f=u()((n=!!p,(e=p)in(t={"chart-box":!0,"chart-trading-view":!0,minimized:o})?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t)),y={};return m&&(y={height:m+"px",minHeight:m+"px",maxHeight:m+"px"}),a.a.createElement("div",{className:f,style:y},a.a.createElement("div",{className:"chart-trading-view-wrapper"},!s&&a.a.createElement(Z.a,null),v.default.mobile()&&[a.a.createElement("div",{className:"minimize-chart hidden-minimized hidden-landscape",key:"minimize-chart",onClick:this.minimize},a.a.createElement("i",{className:"icon-double-arrow-down "})),a.a.createElement(g.a,{className:"change-interval hidden-minimized hidden-landscape",as:"div",name:"chart-interval",key:"chart-interval",selected:c,transformOptionText:function(t){return t},options:r.keys(O.e),onChange:this.changeInterval}),a.a.createElement("div",{className:"restore-size-chart visible-minimized hidden-landscape",key:"restore-size-chart",onClick:this.restoreSize},a.a.createElement("div",null,a.a.createElement("i",{className:"icon-double-arrow-up"})))],a.a.createElement("div",{id:r.uniqueId("chart-trading-view-"),ref:"tvWidget",className:"chart-trading-view-container hidden-minimized"}),Object(at.c)()&&d&&a.a.createElement(it,{className:l?"":"with-sidebar",symbol:d.symbol,term:d.term})))}},{key:"initTradings",value:function(t,e){var n=this;f.a.isChartTradingViewTradingLinesEnabled()&&(this.tvEventsListener.listenTo(t.getPositions(),"add",(function(i){n.positions.push(Object(z.b)(e,t,i,n.theme))})),this.tvEventsListener.listenTo(t.getOrders(),"add",(function(i){n.orders.push(Object(z.a)(e,t,i,n.theme))})),this.initPositions(t,e),this.initOrders(t,e))}},{key:"removeTradings",value:function(t){this.tvEventsListener.stopListening(t.getPositions(),"add"),this.tvEventsListener.stopListening(t.getOrders(),"add"),r.each(this.positions,(function(t){return t.remove()})),r.each(this.orders,(function(t){return t.remove()}))}},{key:"initOrders",value:function(t,e){var n=this;this.orders||(this.orders=[]),r.each(t.getOrders().models,(function(i){n.orders.push(Object(z.a)(e,t,i,n.theme))}))}},{key:"initPositions",value:function(t,e){var n=this;this.positions||(this.positions=[]),r.each(t.getPositions().models,(function(i){n.positions.push(Object(z.b)(e,t,i,n.theme))}))}},{key:"onTradingCentralStatusChanged",value:function(){var t=w.a.getUserCommonData().isTradingCentralEnabled();!this.tvTradingCentral.enabled&&t?this.initTradingCentral():this.tvTradingCentral.enabled&&!t&&this.removeTradingCentral(),Object(O.n)(this.tvWidget)}},{key:"initTradingCentral",value:function(t,e){t&&e||(e=this.tvWidget.symbolInterval().interval,t=this.tvDatafeed.getSubscription(this.tvWidget.symbolInterval().symbol,e).getInstrument()),this.tvTradingCentral.init(t,e),this.setState({tradingCentral:this.tvTradingCentral.options})}},{key:"removeTradingCentral",value:function(){this.tvTradingCentral.destroy(),this.setState({tradingCentral:void 0})}}],[{key:"getSelectedInstrumentSymbol",value:function(){return Object(T.getUiSelectedInstrumentCategorySymbol)(store.getState())}},{key:"getDeepLinkInterval",value:function(){if(Object(L.getDeepLinkPath)(store.getState(),!0)===A.PATH.DETAILS){var t=Object(L.getDeepLinkChart)(store.getState());if(t)return O.e[t.toLowerCase()]}}},{key:"prepareLocalSavedChart",value:function(t){var e=JSON.parse(t);return e.name?{data:{data:e}}:{data:{data:{name:"",content:JSON.stringify({content:t})}}}}},{key:"trade",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.direction===M.BUY&&Object(D.isBuyTradable)(t)?V.a.trigger("ui:new-position",ot({symbolOrId:t},e)):e.direction===M.SELL&&Object(D.isSellTradable)(t)&&V.a.trigger("ui:new-position",ot({symbolOrId:t},e))}}]),e}(a.a.Component);ut.defaultProps={autosize:!0,disabled_features:O.a.DISABLED,enabled_features:O.a.ENABLED,interval:"5",library_path:"tv/",locale:o.getCurrentLanguage()||"en",charts_storage_url:N.a.tradingViewService(),client_id:Object(y.default)(f.a.getBrandName()),user_id:Object(y.default)(w.a.getCustomerId()),charts_storage_api_version:"1.1",auto_save_delay:1,link_to_tradingview:!1,timezone:Object(S.a)(w.a.getUserCommonData().getUserTimezoneObject()),custom_css_url:""+window.location.origin+window.location.pathname+"/"+x.a,time_frames:[{text:"1d",resolution:"1",description:"1 Day"},{text:"5d",resolution:"5",description:"5 Days"},{text:"1m",resolution:"30",description:"1 Month"},{text:"3m",resolution:"60",description:"3 Months"},{text:"6m",resolution:"120",description:"6 Months"},{text:"1y",resolution:"D",description:"1 Year"},{text:"5y",resolution:"W",description:"5 Years"}]};e.default=ut}}]);