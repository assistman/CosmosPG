(window.webpackJsonp=window.webpackJsonp||[]).push([[114],{2175:function(e,t,a){var n;void 0===(n=function(e,t,n){var r=a(2729),i=a(2731);n.exports={MetatraderPopupModel:i,MetatraderPopupView:r}}.call(t,a,t,e))||(e.exports=n)},2729:function(e,t,a){(function(n,r){var i;void 0===(i=function(e,t,n){var r=a(1),i=a(16),o=a(80),s=a(7),d=a(10),l=a(12),c=a(140),u=a(11),f=a(1236),m=r.template(a(2730)),h=a(2),p=h.SUCCESS,v=h.ERROR,g=h.ACTIVE,b=o.extend({name:"metatrader-popup",events:function(){return r.extend({},r.result(o.prototype,"events"),{"click .fn-tab":"changeTab","click .fn-reset-password":"resetPassword"})},initialize:function(e){e.tabId&&this.model.set("currentTabId",e.tabId),e.bonusesTab&&this.model.set("bonusesTab",e.bonusesTab),o.prototype.initialize.apply(this,arguments),this._metatraderLeverage=new f,this.listenTo(this.model,"change:statusOfMetaTraderTradingCentral",this.loadCompleted),this.listenTo(this.model,"change:currentTabId",this.updateTab),this.listenTo(s,"showMetatraderTabById",this.setTabById),this.listenTo(this._metatraderLeverage,"change:statusOfMetaTraderAccounts",this.metaTraderAccountsChanged)},loadCompleted:function(){var e=this.model.get("statusOfMetaTraderTradingCentral");if(e===v)return this.loadError();e===p&&(this.render(),this.updateTab())},loadError:function(){new c({parent:document.body,text:__("server.request.generic.error.body",__("link.contact_us"))}),this.close()},render:function(){return o.prototype.render.call(this),this.setContent(m({tabs:this.model.get("tabs"),currentTabId:this.model.get("currentTabId"),tradingCentral:this.model.get("tradingCentral"),resetPassword:this.model.get("resetPassword"),isMT5PlatformEnabled:l.isMT5PlatformEnabled(),isConditionsTabEnabled:l.isMetaTraderConditionsTabEnabled()})),this},updateTab:function(){var e=this.model.getCurrentTabView(),t=this.model.getCurrentTabId();this.addChildView(".tab-content",e,{model:this.model}),this.$(".header-container-xs .caption").html(__(this.model.getCurrentTabTitle())),this.$(".tab").removeClass("active"),this.$(".tab[data-tab-id="+t+"]").addClass("active")},changeTab:function(e){this.model.setCurrentTabById(i(e.currentTarget).attr("data-tab-id"))},setTabById:function(e){this.model.setCurrentTabById(e),this._metatraderLeverage.reloadMetaTraderAccounts()},resetPassword:function(){var e=d.getCustomerId(),t=d.getEmail();return u.forgotPasswordById(e).then((function(){new c({text:__("mt4.password.need.reset",t),isHeaderShowed:!1,okBtnText:__("ok"),isShowCloseForMobile:!1})}))},metaTraderAccountsChanged:function(){this.showLeverageTab(),this.showBonusesTab(),this.showFundsTransferTab()},showLeverageTab:function(){var e=this;if(l.isMetaTraderInternalLeverageEnabled()){var t=r.filter(this._metatraderLeverage.get("metaTraderAccounts"),(function(t){return e.model.hasPlatformAccountId(t)&&e.model.isTradingAccountStatus(t,g)})),a=this._metatraderLeverage.get("availableLeverages"),n=r.isEmpty(a)||1===a.length&&r.every(t,(function(e){return e.leverage===a[0]}));if(r.isEmpty(t)||n)return;this.$el.find('li[data-tab-id="metatrader-leverage"]').removeClass("hidden")}},showBonusesTab:function(){var e=this;if(l.isBonusesEnabled()){var t=r.filter(this._metatraderLeverage.get("metaTraderAccounts"),(function(t){return e.model.hasPlatformAccountId(t)&&e.model.isTradingAccountStatus(t,g)&&t.hasBonuses}));if(r.isEmpty(t))return;this.$el.find('li[data-tab-id="metatrader-bonuses"]').removeClass("hidden")}},showFundsTransferTab:function(){var e=this;if(l.isMetaTraderInternalFundsTransferEnabled()){var t=r.filter(this._metatraderLeverage.get("metaTraderAccounts"),(function(t){return e.model.hasPlatformAccountId(t)&&e.model.isTradingAccountStatus(t,g)}));r.isEmpty(t)||this.$el.find('li[data-tab-id="metatrader-funds-transfer"]').removeClass("hidden")}}});n.exports=function(e){return new b(r.extend({},e,{headerStyle:"default",isHeaderShowed:!0,closeIconStyle:"blue",headerBgStyle:"transparent"}))}}.call(t,a,t,e))||(e.exports=i)}).call(this,a(1),a(16))},2730:function(e,t){e.exports="<div class=metatrader-popup> <div class=modal-dialog-container></div> <div class=\"metatrader-body flex-stretch\"> <div class=\"tabs hidden-xs\"> <ul> <% _.each(tabs, function(tab) { %> <li class=\"tab fn-tab <%- currentTabId == tab.id ? 'active' : '' %> tab-<%= tab.id%> <%- tab.hidden ? 'hidden' : '' %>\" data-tab-id=\"<%- tab.id %>\"> <a><%- __(tab.title) %></a> </li> <% }) %> <% if (tradingCentral) { %> <li class=tab> <a href=\"<%= tradingCentral %>\" target=_blank><%= __('metatrader.technical-analysis.title') %></a> </li> <% } %> <% if (isConditionsTabEnabled) { %> <li class=tab> <%= __('metatrader.trading-conditions.title') %> </li> <% } %> <% if (isMT5PlatformEnabled) { %> <li class=tab> <%= __('metatrader.mt5-platform.title') %> </li> <% } %> <% if (resetPassword) { %> <li class=\"tab fn-reset-password\"> <a><%= __('metatrader.reset-password.title') %></a> </li> <% } %> </ul> </div> <div class=tab-content></div> </div> </div> "},2731:function(e,t,a){(function(n){var r;void 0===(r=function(e,t,n){var r=a(1),i=a(897),o=a(2732),s=a(2735),d=a(2738),l=a(2740),c=a(2743),u=a(2746),f=a(11),m=a(227),h=a(2),p=h.SUCCESS,v=h.ERROR,g=h.LOADING;n.exports=i.extend({defaults:function(){return{tabs:[{id:"metatrader-accounts",url:"metatrader-accounts",title:"metatrader.accounts.title",view:o,hidden:!1},{id:"metatrader-funds-transfer",url:"metatrader-funds-transfer",title:"metatrader.funds-transfer.title",view:s,hidden:!0},{id:"metatrader-leverage",url:"metatrader-leverage",title:"metatrader.leverage.title",view:d,hidden:!0},{id:"metatrader-add-account",url:"metatrader-add-account",title:"metatrader.add-account.title",view:l,hidden:!1},{id:"metatrader-deposit",url:"metatrader-deposit",title:"actions.deposit",view:c,hidden:!1},{id:"metatrader-bonuses",url:"metatrader-bonuses",title:"metatrader.bonuses.title",view:u,hidden:!0}],currentTabId:"metatrader-accounts",defaultTabId:"metatrader-accounts",resetPassword:!1}},initialize:function(){var e=this;i.prototype.initialize.apply(this,arguments);var t=this.status("statusOfMetaTraderTradingCentral");return t(g),f.getMetaTraderTradingCentral().then((function(a){m.isExternalLoginDetected()&&e.set("resetPassword",!0),t(p,{tradingCentral:a.data})})).catch((function(e){t(v)}))},getCurrentTab:function(){return r.findWhere(this.get("tabs"),{id:this.getCurrentTabId()})},getCurrentTabId:function(){var e=this.get("currentTabId");return e||(e=this.get("defaultTabId")),e},getCurrentTabTitle:function(){var e=this.getCurrentTab(),t=null;return e&&(t=e.title||t),t},getCurrentTabView:function(){var e=this.getCurrentTab(),t=null;return e&&(t=e.view||t),t},getTabById:function(e){return r.findWhere(this.get("tabs"),{id:e})},setCurrentTabById:function(e){var t=this.getTabById(e);return t&&this.set({currentTabId:t.id}),t}})}.call(t,a,t,e))||(e.exports=r)}).call(this,a(1))},2732:function(e,t,a){(function(n,r){var i;void 0===(i=function(e,t,n){var r=a(1),i=a(21),o=a(97),s=a(2733),d=a(16),l=a(7),c=a(10),u=a(83),f=a(12),m=r.template(a(2734)),h=a(2),p=h.ACTIVE,v=h.PENDING,g=h.ERROR,b=h.SUCCESS,_=i.extend({className:"metatrader-accounts",events:function(){return r.extend({},r.result(i.prototype,"events"),{"click .fn-show-add-account-tab":"showAddAccountTab","click .fn-toggle":"toggleRow"})},initialize:function(){i.prototype.initialize.apply(this,arguments),this.model=new s,this.listenTo(this.model,"change:statusOfMetaTraderAccounts",this.loadCompleted)},loadCompleted:function(){var e=this.model.get("statusOfMetaTraderAccounts");if(e===g)return this.loadError();e===b&&(this.removeChildView(".metatrader-accounts"),this.showTemplate())},loadError:function(){this.removeChildView(".metatrader-accounts"),l.trigger("ui:message-box",{parent:document.body,text:__("server.request.generic.error.body",__("link.contact_us"))})},showTemplate:function(){var e=this,t=r.filter(this.model.get("metaTraderAccounts"),(function(t){return e.model.hasPlatformAccountId(t)&&(e.model.isTradingAccountStatus(t,p)||e.model.isTradingAccountStatus(t,v))})),a=(100*c.getUserAccountSettingsModel().getLiquidationLevel()).toFixed(),n=(100*c.getUserAccountSettingsModel().getMarginAlertLevel2()).toFixed(),i=this.isBonusesEnabled();return this.$el.html(m({accounts:t,numbro:u,liquidationLevel:a,marginAlertLevel2:n,isBonusesEnabled:i})),this},render:function(){return i.prototype.render.apply(this,arguments),this.addChildView(".metatrader-accounts",o,{parent:this.$el,translucent:"2"}),this},showAddAccountTab:function(){l.trigger("showMetatraderTabById","metatrader-add-account")},toggleRow:function(e){var t=d(e.target),a=t.closest(".row");d(a).hasClass("expanded")?(d(a).removeClass("expanded"),t.html("+")):(d(a).addClass("expanded"),t.html("-"));var n=a.nextElementSibling;d(n).hasClass("expanded")?d(n).removeClass("expanded"):d(n).addClass("expanded")},isBonusesEnabled:function(){return f.isBonusesEnabled()}});n.exports=_}.call(t,a,t,e))||(e.exports=i)}).call(this,a(1),a(16))},2733:function(e,t,a){var n;void 0===(n=function(e,t,n){var r=a(897),i=a(2).EMPTY;n.exports=r.extend({defaults:function(){return{statusOfMetaTraderAccounts:i}},initialize:function(){r.prototype.initialize.apply(this,arguments),this.loadMetaTraderAccounts()}})}.call(t,a,t,e))||(e.exports=n)},2734:function(e,t){e.exports='<table> <thead class=columns> <tr> <th class="column column-account"><%=__(\'metatrader.accounts.account\')%></th> <th class="column column-status"><%=__(\'metatrader.accounts.status\')%></th> <th class="column column-action hidden-xs"> <button class="btn btn-default btn-mobile-bottom fn-show-add-account-tab"> <span class=icon-circle>+</span><%=__(\'metatrader.accounts.actions.add-account\')%></button> </th> </tr> </thead> <tbody class=rows> <% _.each(accounts, function(account) { %> <tr class=row> <td class=row-accounts> <span class="icon-square fn-toggle">+</span> <%- account.tradePlatformType %> - <%- account.accountId %> - <%- account.currency %> </td> <td class=row-status><%=__(\'metatrader.accounts.status.\' + account.tradingAccountStatus)%> - <%=__(\'metatrader.accounts.type.\' + account.tradingAccountType)%></td> <td class="metatrader-accounts-actions actions hidden-xs"> <% if(account.webLink) { %> <a class="btn btn-icon" href="<%- account.webLink %>" target=_blank title="<%=__(\'metatrader.accounts.sirix\')%>"><i class="icon icon-launch-sirix-blue"></i></a> <% } %> <% if(account.downloadLink) { %> <a class="btn btn-icon" href="<%- account.downloadLink %>" target=_blank title="<%=__(\'metatrader.accounts.download.\' + account.tradePlatformType)%>"><i class="icon icon-download-blue"></i></a> <% } %> <% if(account.accountStatementLink) { %> <a class="btn btn-icon" href="<%- account.accountStatementLink %>" target=_blank title="<%=__(\'metatrader.accounts.account-statement\')%>"><i class="icon icon-report-blue"></i></a> <% } %> </td> </tr> <tr class="row expandable-content"> <td class=info-column-left> <div class=info-row> <div class=info-row-left> <span class="icon icon-help" aria-label="<%=__(\'help.account.balance\')%>"></span> <%=__(\'metatrader.accounts.balance\')%> </div> <div><%- numbro(account.balance).formatForeignCurrency(__currency(account.currency)) %></div> </div> <div class=info-row> <div class=info-row-left> <span class="icon icon-help" aria-label="<%=__(\'help.account.equity\')%>"></span> <%=__(\'metatrader.accounts.equity\')%> </div> <div><%- numbro(account.equity).formatForeignCurrency(__currency(account.currency)) %></div> </div> <div class=info-row> <div class=info-row-left> <span class="icon icon-help" aria-label="<%=__(\'help.account.free_margin\')%>"></span> <%=__(\'metatrader.accounts.free-margin\')%> </div> <div><%- numbro(account.freeMargin).formatForeignCurrency(__currency(account.currency)) %></div> </div> <div class=info-row> <div class=info-row-left> <span class="icon icon-help" aria-label="<%=__(\'help.account.login\')%>"></span> <%=__(\'indigo.new_account.login_link\')%> </div> <div><%- account.platformAccountId %></div> </div> </td> <td class=info-column-right> <div class=info-row> <div class=info-row-left> <span class="icon icon-help" aria-label="<%=__(\'help.account.used_margin\')%>"></span> <%=__(\'metatrader.accounts.used-margin\')%> </div> <div><%- numbro(account.usedMargin).formatForeignCurrency(__currency(account.currency)) %></div> </div> <div class=info-row> <div class=info-row-left> <span class="icon icon-help" aria-label="<%=__(\'help.account.margin_level\',marginAlertLevel2,liquidationLevel)%>"></span> <%=__(\'metatrader.accounts.margin-level\')%> </div> <div> <% if (account.marginLevel) {%> <%=account.marginLevel%>% <% } else { %> N/A <% } %> </div> </div> <% if (isBonusesEnabled && account.hasCashBonuses) { %> <div class=info-row> <div class=info-row-left> <span class="icon icon-help" aria-label="<%=__(\'funds.management.bonuses.help\')%>"></span> <%=__(\'metatrader.accounts.bonuses\')%> </div> <div><%- numbro(account.accountBonusesAmount).formatForeignCurrency(__currency(account.currency)) %></div> </div> <% } %> <div class=info-row> <div class=info-row-left> <span class="icon icon-help" aria-label="<%=__(\'funds.management.available.help\')%>"></span> <%=__(\'metatrader.accounts.available-withdrawal\')%> </div> <div><%- numbro(account.availableForWithdrawal).formatForeignCurrency(__currency(account.currency)) %></div> </div> </td> </tr> <% }) %> </tbody> </table> <button class="btn btn-primary btn-mobile-bottom fn-show-add-account-tab hidden-sm hidden-md hidden-lg"> <span class=icon-circle>+</span><%=__(\'metatrader.accounts.actions.add-account\')%></button> '},2735:function(e,t,a){(function(n){var r;void 0===(r=function(e,t,n){var r=a(1),i=a(21),o=a(97),s=a(7),d=a(165),l=a(585),c=a(586),u=a(2736),f=r.template(a(2737)),m=a(2),h=m.LIVE_ACCOUNT_ID,p=m.EMPTY,v=m.ERROR,g=m.SUCCESS,b=m.VALIDATE,_=m.PROCESSING,T=i.extend({className:"metatrader-funds-transfer",events:function(){return this.addEvents(i)({"click .fn-funds-transfer":"fundsTranfer"})},initialize:function(e){i.prototype.initialize.apply(this,arguments),this.model=new u,this.listenTo(this.model,"change:statusOfAllAccounts",this.loadCompleted),this.listenTo(this.model,"change:statusOfFundsTransfer",this.onStatusOfFundsTransferChanged)},loadCompleted:function(){var e=this.model.get("statusOfAllAccounts");if(e===v)return this.loadError();e===g&&(this.removeChildView(".loading-wrapper"),this.$el.find(".funds-transfer").removeClass("hidden"),this.createForm())},loadError:function(){this.removeChildView(".loading-wrapper"),s.trigger("ui:message-box",{parent:document.body,text:__("server.request.generic.error.body",__("link.contact_us.funded.client"))})},createForm:function(){var e=this,t=this.$el.find(".funds-transfer-form"),a=r.filter(this.model.get("allAccounts"),(function(t){return e.model.hasPlatformAccountId(t)&&e.model.isTradingAccountType(t,h)})),n={form:[[{disable:!1,template:d.inputAddon,title:__("metatrader.funds-transfer.amount")+":",name:"field_amount",addonText:"$",type:"text",translationKey:"",validation:{filters:["trim","number"],rules:{min:[1,__("errors.required",__("metatrader.funds-transfer.amount"))],not_empty:__("errors.required",__("metatrader.funds-transfer.amount"))}},dependent:[{name:"field_platformAccountIdFrom",handler:this.changeInputAddonText.bind(this)}]}],[{disable:!1,template:d.selectBox,title:__("metatrader.funds-transfer.origin-account")+":",name:"field_platformAccountIdFrom",savedData:r.first(a).accountId,options:a,transformOptionsValue:function(e){return e.accountId},transformOptionText:function(e){var t=e.accountId,a=e.tradePlatformType,n=e.currency;return(a="COSMOS"===a?__("brand.name"):a)+" Trader - "+t+" - "+String(n).toUpperCase()},translationKey:"",validation:{rules:{not_empty:__("errors.required",__("metatrader.funds-transfer.origin-account"))}},dependent:[{name:"field_platformAccountIdTo",handler:this.removeAccountFromSelect}]}],[{disable:!1,template:d.selectBox,title:__("metatrader.funds-transfer.destination-account")+":",name:"field_platformAccountIdTo",options:a,transformOptionsValue:function(e){return e.accountId},transformOptionText:function(e){var t=e.accountId,a=e.tradePlatformType,n=e.currency;return(a="COSMOS"===a?__("brand.name"):a)+" Trader - "+t+" - "+String(n).toUpperCase()},translationKey:"",validation:{rules:{not_empty:__("errors.required",__("metatrader.funds-transfer.destination-account"))}},dependent:[{name:"field_platformAccountIdFrom",handler:this.removeAccountFromSelect}]}]]},i=new c(n);this.formView=new l({model:i,$parent:t}),this.formView.show(),this.formView.form.$(".field-type-input-addon > .field-status").html(__("metatrader.funds-transfer.amount.info"))},removeAccountFromSelect:function(e){this.$el.find('[disabled="disabled"]').removeAttr("disabled"),this.$el.find(".hidden").removeClass("hidden");var t=e.value();this.$el.find('[value="'+t+'"]').attr("disabled","disabled"),this.$el.find('[data-value="'+t+'"]').addClass("hidden")},changeInputAddonText:function(e){var t=this.model.get("allAccounts"),a=r.find(t,(function(t){return t.accountId===e.value()}));this.getAmountField().$el.find(".field-addonText").html(__currency(a.currency))},getAllAccountsIds:function(){return r.pluck(this.model.get("allAccounts"),"accountId")},render:function(){return i.prototype.render.call(this),this.$el.html(f(this.options)),this.addChildView(".loading-wrapper",o,{parent:this.$el,translucent:"2"}),this.$el.find(".funds-transfer").addClass("hidden"),this},getAccountIdFromField:function(){return this.formView.form.getField("field_platformAccountIdFrom")},getAccountIdToField:function(){return this.formView.form.getField("field_platformAccountIdTo")},getAmountField:function(){return this.formView.form.getField("field_amount")},fundsTranfer:function(){this.model.set("statusOfFundsTransfer",b)},onStatusOfFundsTransferChanged:function(){var e=this.model,t=e.get("statusOfFundsTransfer"),a=this.getAccountIdFromField().value(),n=this.getAccountIdToField().value(),i=this.getAmountField().value();switch(t){case b:if(e.set("statusOfFundsTransfer",p),this.formView.form.validate())return;var s=this.model.get("allAccounts"),d=r.find(s,(function(e){return e.accountId===a})).currency;return void e.fundsTransfer(+a,+n,+i,d);case _:return void this.addChildView(".loading-wrapper",o,{parent:this.$el,translucent:"2"});case g:return this.removeChildView(".loading-wrapper"),this.getAmountField().value(""),this.getAccountIdToField().fieldVerified(),void this.getAccountIdToField().setTooltipMessage(__("metatrader.funds-transfer.success"));case v:return this.removeChildView(".loading-wrapper"),void this.loadError()}}});n.exports=T}.call(t,a,t,e))||(e.exports=r)}).call(this,a(1))},2736:function(e,t,a){var n;void 0===(n=function(e,t,n){var r=a(897),i=a(11),o=a(2),s=o.EMPTY,d=o.ERROR,l=o.SUCCESS,c=o.PROCESSING;n.exports=r.extend({defaults:function(){return{statusOfAllAccounts:s,statusOfFundsTransfer:s}},initialize:function(){r.prototype.initialize.apply(this,arguments),this.loadAllAccounts()},fundsTransfer:function(e,t,a,n){var r=this.status("statusOfFundsTransfer");if(r(c),!e||!t||!a)return r(d);var o={from:e,to:t,amount:a,currency:n};i.metaTraderFundsTransfer(o).then((function(e){return r(l)})).catch((function(e){r(d)}))}})}.call(t,a,t,e))||(e.exports=n)},2737:function(e,t){e.exports="<div class=funds-transfer> <div class=funds-transfer-info><%=__('metatrader.funds-transfer.info')%></div> <div class=funds-transfer-form></div> </div> <div class=form-col> <button class=\"btn btn-primary btn-mobile-bottom btn-block fn-funds-transfer\"><%- __('actions.submit') %></button> </div> <div class=loading-wrapper></div>"},2738:function(e,t,a){(function(n){var r;void 0===(r=function(e,t,n){var r=a(1),i=a(21),o=a(97),s=a(7),d=a(165),l=a(585),c=a(586),u=a(1236),f=r.template(a(2739)),m=a(2),h=m.ACTIVE,p=m.EMPTY,v=m.ERROR,g=m.SUCCESS,b=m.VALIDATE,_=m.PROCESSING,T=i.extend({className:"metatrader-leverage",events:function(){return this.addEvents(i)({"click .fn-leverage-change":"changeLeverage"})},initialize:function(e){i.prototype.initialize.apply(this,arguments),this.model=new u,this.listenTo(this.model,"change:statusOfMetaTraderAccounts",this.loadCompleted),this.listenTo(this.model,"change:statusOfLeverageChange",this.onStatusOfLeverageChanged)},loadCompleted:function(){var e=this.model.get("statusOfMetaTraderAccounts");if(e===v)return this.loadError();e===g&&(this.removeChildView(".loading-wrapper"),this.$el.find(".meta-leverage").removeClass("hidden"),this.createForm())},loadError:function(){this.removeChildView(".loading-wrapper"),s.trigger("ui:message-box",{parent:document.body,text:__("server.request.generic.error.body",__("link.contact_us"))})},createForm:function(){var e=this,t=this.$el.find(".metatrader-leverage-form"),a=r.filter(this.model.get("metaTraderAccounts"),(function(t){return e.model.hasPlatformAccountId(t)&&e.model.isTradingAccountStatus(t,h)})),n={form:[[{disable:!1,template:d.selectBox,title:__("metatrader.leverage.account")+":",name:"field_platformAccountId",savedData:r.first(a).accountId,options:a,transformOptionsValue:function(e){return e.accountId},transformOptionText:function(e){var t=e.accountId,a=e.tradePlatformType,n=e.currency;return(a="COSMOS"===a?__("brand.name"):a)+" Trader - "+t+" - "+String(n).toUpperCase()},translationKey:"",validation:{rules:{not_empty:__("errors.required",__("metatrader.leverage.account"))}}}],[{disable:!0,template:d.inputBox,title:__("metatrader.leverage.current-leverage")+":",name:"field_currentLeverage",translationKey:"",validation:{rules:{not_empty:__("errors.required",__("metatrader.leverage.current-leverage"))}},dependent:[{name:"field_platformAccountId",handler:this.setLeverageByAccountId.bind(this)}]},{disable:!1,template:d.selectBox,title:__("metatrader.leverage.new-leverage")+":",name:"field_newLeverage",savedData:"1:"+r.first(this.model.get("availableLeverages")),options:this.model.get("availableLeverages"),transformOptionText:function(e){return"1:"+e},translationKey:"",validation:{rules:{not_empty:__("errors.required",__("metatrader.leverage.new-leverage"))}},dependent:[{name:"field_platformAccountId",handler:this.setLeverageOptionsByAccountId.bind(this)}]}]]},i=new c(n);this.formView=new l({model:i,$parent:t}),this.formView.show()},setLeverageByAccountId:function(e){var t=this.model.get("metaTraderAccounts"),a=r.find(t,(function(t){return t.accountId===e.value()}));this.getCurrentLeverageField().setValue("1:"+a.leverage)},setLeverageOptionsByAccountId:function(e){var t=this,a=this.model.get("availableLeverages"),n=this.model.get("metaTraderAccounts"),i=r.find(n,(function(t){return t.accountId===e.value()}));this.getNewLeverageField();a.forEach((function(e){t.$el.find('[value="'+e+'"]').removeAttr("disabled"),t.$el.find('[data-value="'+e+'"]').removeClass("hidden")})),this.$el.find('[value="'+i.leverage+'"]').attr("disabled","disabled"),this.$el.find('[data-value="'+i.leverage+'"]').addClass("hidden")},getAllAccountsIds:function(){return r.pluck(this.model.get("allAccounts"),"tpId")},render:function(){return i.prototype.render.call(this),this.$el.html(f(this.options)),this.addChildView(".loading-wrapper",o,{parent:this.$el,translucent:"2"}),this.$el.find(".meta-leverage").addClass("hidden"),this},getAccountIdField:function(){return this.formView.form.getField("field_platformAccountId")},getCurrentLeverageField:function(){return this.formView.form.getField("field_currentLeverage")},getNewLeverageField:function(){return this.formView.form.getField("field_newLeverage")},changeLeverage:function(){this.model.set("statusOfLeverageChange",b)},onStatusOfLeverageChanged:function(){var e=this.model,t=e.get("statusOfLeverageChange"),a=+this.getAccountIdField().value(),n=+this.getNewLeverageField().value();switch(t){case b:if(e.set("statusOfLeverageChange",p),this.formView.form.validate())return;return void e.changeLeverage(a,n);case _:return void this.addChildView(".loading-wrapper",o,{parent:this.$el,translucent:"2"});case g:return this.removeChildView(".loading-wrapper"),this.getNewLeverageField().value(""),this.getAccountIdField().fieldVerified(),void this.getAccountIdField().setTooltipMessage(__("metatrader.leverage.success"));case v:return void this.removeChildView(".loading-wrapper")}}});n.exports=T}.call(t,a,t,e))||(e.exports=r)}).call(this,a(1))},2739:function(e,t){e.exports="<div class=meta-leverage> <div class=metatrader-leverage-info><%=__('metatrader.leverage.info.select')%></div> <div class=metatrader-leverage-info><%=__('metatrader.leverage.info.period')%></div> <div class=metatrader-leverage-info><%=__('metatrader.leverage.info.position-closed')%></div> <div class=metatrader-leverage-form></div> <div class=form-col> <button class=\"btn btn-primary btn-mobile-bottom btn-block fn-leverage-change\"><%- __('actions.submit') %></button> </div> <ul class=metatrader-leverage-list> <li><%=__('metatrader.leverage.info.profile')%></li> <li><%=__('metatrader.leverage.info.policy')%></li> </ul> </div> <div class=loading-wrapper></div>"},2740:function(e,t,a){(function(n){var r;void 0===(r=function(e,t,n){var r=a(1),i=a(21),o=a(97),s=a(165),d=a(585),l=a(586),c=a(2741),u=a(7),f=a(12),m=r.template(a(2742)),h=a(2),p=h.EMPTY,v=h.ERROR,g=h.SUCCESS,b=h.VALIDATE,_=h.PROCESSING,T=i.extend({className:"metatrader-add-account",events:function(){return this.addEvents(i)({"click .fn-add-account":"addAccount"})},initialize:function(e){i.prototype.initialize.apply(this,arguments),this.model=new c,this.listenTo(this.model,"change:statusOfMetaTraderAccounts",this.loadCompleted),this.listenTo(this.model,"change:statusOfAddAccount",this.onStatusOfAddAccountChanged)},loadCompleted:function(){var e=this.model.get("statusOfMetaTraderAccounts");if(e===v)return this.loadError();e===g&&(this.removeChildView(".loading-wrapper"),this.$el.find(".add-account").removeClass("hidden"),this.createForm())},loadError:function(){this.removeChildView(".loading-wrapper"),u.trigger("ui:message-box",{parent:document.body,text:__("server.request.generic.error.body",__("link.contact_us"))})},createForm:function(){var e=this.$el.find(".add-account-form"),t=this.model.get("metaTraderConfiguration"),a=[],n=[],i=[];r.map(t,(function(e){a.push(e.tradePlatformType),n=n.concat(e.availableCurrencies),i=i.concat(e.accountTypeList)})),n=r.uniq(n),i=r.uniq(i);var o={form:[[{disable:!1,template:s.selectBox,title:__("metatrader.add-account.type.title")+":",name:"field_accountType",savedData:i[0],options:i,transformOptionText:function(e){return __("metatrader.add-account.type."+e)},translationKey:"",validation:{rules:{not_empty:__("errors.required",__("metatrader.add-account.type.title"))}}}],[{disable:!1,template:s.selectBox,title:__("metatrader.add-account.trading-platform.title")+":",name:"field_tradingPlatform",savedData:a[0],options:a,transformOptionText:function(e){return __("metatrader.add-account.trading-platform."+e)},translationKey:"",validation:{rules:{not_empty:__("errors.required",__("metatrader.add-account.trading-platform.title"))}}}],[{disable:!1,template:s.selectBox,title:__("metatrader.add-account.currency")+":",name:"field_currency",savedData:n[0],options:n,transformOptionText:function(e){return e},translationKey:"",validation:{rules:{not_empty:__("errors.required",__("metatrader.add-account.currency"))}},dependent:[{name:"field_tradingPlatform",handler:this.changeCurrenciesOptions.bind(this)}]}]]};this.addLeverageElement(o);var c=new l(o);this.formView=new d({model:c,$parent:e}),this.formView.show()},addLeverageElement:function(e){var t=this.getCurrentLeverages();1===t.length?e.form.push([{title:__("metatrader.add-account.leverage")+":",translationKey:"",template:s.textLabel,description:"1:"+t[0]}]):e.form.push([{disable:!1,template:s.selectBox,title:__("metatrader.add-account.leverage")+":",name:"field_leverage",savedData:t[0],options:t,transformOptionText:function(e){return"1:"+e},translationKey:"",validation:{rules:{not_empty:__("errors.required",__("metatrader.add-account.leverage"))}}}])},getCurrentLeverages:function(){return f.isMetaTraderInternalLeverageEnabled()?this.model.get("availableLeverages"):[this.model.get("defaultLeverage")]},render:function(){return i.prototype.render.call(this),this.$el.html(m(this.options)),this.addChildView(".loading-wrapper",o,{parent:this.$el,translucent:"2"}),this.$el.find(".add-account").addClass("hidden"),this},getAccountTypeField:function(){return this.formView.form.getField("field_accountType")},getTradingPlatformField:function(){return this.formView.form.getField("field_tradingPlatform")},getCurrencyField:function(){return this.formView.form.getField("field_currency")},getLeverageField:function(){return this.formView.form.getField("field_leverage")},addAccount:function(){this.model.set("statusOfAddAccount",b)},changeCurrenciesOptions:function(e){var t=this.model.get("metaTraderConfiguration"),a=void 0;r.map(t,(function(t){t.tradePlatformType===e.value()&&(a=t)})),this.getCurrencyField().value(a.availableCurrencies[0]),this.showCurrenciesInSelect(a.availableCurrencies)},showCurrenciesInSelect:function(e){var t=this.$el.find('[name="field_currency"]');t.find(".dk-option").addClass("hidden"),t.find("option").attr("disabled","disabled"),r.map(e,(function(e){t.find('[value="'+e+'"]').removeAttr("disabled"),t.find('[data-value="'+e+'"]').removeClass("hidden")}))},onStatusOfAddAccountChanged:function(){var e=this.model,t=e.get("statusOfAddAccount"),a=this.getAccountTypeField().value(),n=this.getTradingPlatformField().value(),r=this.getCurrencyField().value(),i=this.getCurrentLeverages(),s=1===i.length?i[0]:this.getLeverageField().value();switch(t){case b:if(e.set("statusOfAddAccount",p),this.formView.form.validate())return;return void e.addAccount(a,n,r,s);case _:return void this.addChildView(".loading-wrapper",o,{parent:this.$el,translucent:"2"});case g:return this.removeChildView(".loading-wrapper"),void u.trigger("showMetatraderTabById","metatrader-accounts");case v:return this.removeChildView(".loading-wrapper"),void this.loadError()}}});n.exports=T}.call(t,a,t,e))||(e.exports=r)}).call(this,a(1))},2741:function(e,t,a){var n;void 0===(n=function(e,t,n){var r=a(897),i=a(11),o=a(2),s=o.EMPTY,d=o.ERROR,l=o.SUCCESS,c=o.PROCESSING;n.exports=r.extend({defaults:function(){return{statusOfMetaTraderAccounts:s,statusOfAddAccount:s}},initialize:function(){r.prototype.initialize.apply(this,arguments),this.loadMetaTraderAccounts()},addAccount:function(e,t,a,n){var r=this.status("statusOfAddAccount");if(r(c),!(e&&t&&a&&n))return r(d);i.metaTraderAddAccount({accountType:e,platformType:t,currency:a,leverage:n}).then((function(e){return r(l)})).catch((function(e){r(d)}))}})}.call(t,a,t,e))||(e.exports=n)},2742:function(e,t){e.exports="<div class=add-account> <div class=add-account-title><%=__('metatrader.add-account.title')%></div> <div class=add-account-form></div> </div> <div class=\"form-col btn-col\"> <button class=\"btn btn-primary btn-mobile-bottom btn-block fn-add-account\"><%- __('actions.create') %></button> </div> <div class=loading-wrapper></div> "},2743:function(e,t,a){(function(n,r){var i;void 0===(i=function(e,t,n){var i=a(1),o=a(21),s=a(374).DepositPopupView,d=a(97),l=a(7),c=a(2744),u=a(165),f=a(585),m=a(586),h=a(10),p=a(12),v=a(919),g=a(1250),b=a(921),_=a(920),T=i.template(a(2745)),A=a(2),w=A.LIVE_ACCOUNT_ID,C=A.ERROR,y=A.SUCCESS,I=A.DEPOSIT_STATUSES,x=s.extend({className:"metatrader-deposit",name:"metatrader-deposit",initialize:function(e){o.prototype.initialize.apply(this,arguments),this.model=new c,this.listenTo(this.model,"change:statusOfFrame",this.frameLoaded),this.listenTo(this.model,"change:statusOfAllAccounts",this.loadCompleted),this.listenTo(this.model,"change:statusOfDepositAmountConfig",this.loadCompleted),this.listenTo(this,"form:depositForm:change:field_platformAccountId",this.onAccountChanged),this.render()},render:function(){return o.prototype.render.call(this),this.$el.html(T(this.options)),this.addChildView(".deposit-popup",d,{parent:this.$el,translucent:"2"}),this},loadCompleted:function(){var e=this.model.get("statusOfAllAccounts"),t=this.model.get("statusOfDepositAmountConfig");if(e===C||t===C)return this.loadError();e===y&&t===y&&this.createForm()},loadError:function(){this.removeChildView(".deposit-popup"),l.trigger("ui:message-box",{parent:document.body,text:__("server.request.generic.error.body",__("link.contact_us.funded.client"))})},createForm:function(){var e=this,t=this.$el.find(".deposit-form"),a=i.filter(this.model.get("allAccounts"),(function(t){return e.model.hasPlatformAccountId(t)&&e.model.isTradingAccountType(t,w)})),n={form:[[{disable:!1,template:u.selectBox,title:__("auto.withdrawal.trading_account"),name:"field_platformAccountId",options:a,transformOptionsValue:function(e){return e.accountId},transformOptionText:function(e){var t=e.accountId,a=e.tradePlatformType,n=e.currency;return(a="COSMOS"===a?__("brand.name"):a)+" Trader - "+t+" - "+String(n).toUpperCase()},translationKey:"",validation:{rules:{not_empty:__("errors.required",__("auto.withdrawal.trading_account"))}}}]]},r=new m(n);for(var o in this.formView=new f({model:r,$parent:t}),this.formView.show(),this.formView.form._fields){var s=this.formView.form._fields[o];this.listenTo(s,"all",(function(t,a,n){e.trigger("form:depositForm:"+t+":"+a._name,a,n)}))}this.removeChildView(".deposit-popup")},showManualDepositPopup:function(e){var t=this,a=new g(e);new v({parent:r("body"),source:"metatrader",model:a,onClose:function(){null,t.removeChildView(".deposit-popup")},onSuccess:function(){var e=t.formView.form.getField("field_platformAccountId").value(),n=t.model.getAccountById(e);null,t.model.set("amount",a.get("amount")),t.model.loadFrame(n)}})},showFirstDepositBonusPopup:function(e){var t=this,a=new b(e);new _({parent:r("body"),source:"metatrader",model:a,onClose:function(){var e=t.formView.form.getField("field_platformAccountId").value(),n=t.model.getAccountById(e);if(null,I.CANCELLED!==a.get("status")){if(t.model.set("bonusApplied",a.get("bonusApplied")),I.MANUAL_SELECT_AMOUNT===a.get("status"))return t.showManualDepositPopup(n);t.model.set("amount",a.get("selectedAmount")),t.model.loadFrame(n)}else t.removeChildView(".deposit-popup")},isHeaderShowed:!0,caption:__("deposit_bonus_table.popup.header")})},onAccountChanged:function(){var e=this.formView.form.getField("field_platformAccountId").value(),t=this.model.getAccountById(e);this.addChildView(".deposit-popup",d,{parent:this.$el,translucent:"2"}),this.isFirstDepositBonusEnabled(t.currency)?this.showFirstDepositBonusPopup(t):p.isManualDepositAmountNeeded()?this.showManualDepositPopup(t):(this.model.set("amount",this.model.getDefaultAmount()),this.model.loadFrame(t))},frameLoaded:function(){var e=this.model,t=e.get("statusOfFrame");if(t===C)return this.loadError();t===y&&(this.removeChildView(".deposit-popup"),this.renderFrame(e.get("depositHref")),this.subscribe())},close:function(){},isFirstDepositBonusEnabled:function(e){return p.isBonusesEnabled()&&p.isMtFirstDepositBonusEnabled()&&!h.isFirstDeposit()&&h.getUserAwardsModel().isFirstDepositExists(e)}});n.exports=x}.call(t,a,t,e))||(e.exports=i)}).call(this,a(1),a(16))},2744:function(e,t,a){(function(n){var r;void 0===(r=function(e,t,n){var r=a(897),i=a(1),o=a(11),s=a(10),d=a(12),l=a(838).default,c=a(2),u=c.EMPTY,f=c.LOADING,m=c.ERROR,h=c.SUCCESS,p=c.PAY_GATE,v=c.SOLID_PAYMENTS,g=c.SAFE_CHARGE,b=c.PRAXIS,_=a(63);n.exports=r.extend({defaults:function(){return{amount:0,bonusApplied:!1,statusOfFrame:u,statusOfAllAccounts:u}},initialize:function(){r.prototype.initialize.apply(this,arguments),this.loadAllAccounts(),this.loadDepositAmountConfig()},loadFrame:function(e){var t=this.status("statusOfFrame");t(f);var a=_.baseUrl,n={accountId:e.accountId,amount:this.choseDepositAmount(),country:s.getCountry(),currency:e.currency,locale:l(),bonusApproved:this.isBonusApplied()},r=d.getPaymentsServiceVendor();r!==p&&r!==g&&r!==b||(n.successUrl=encodeURIComponent(a+"deposit.html"),n.failUrl=encodeURIComponent(a+"deposit_failed.html")),r===v&&(n.successUrl=encodeURIComponent(a+"?path=solid_payments_deposit_sucess&first_deposit="+this.get("doFirstDeposit")+"&totalAmount="+this.getAmount()+"&atmAmount="+this.getAtmAmount()+"&currency="+s.getUserCurrency()),n.failUrl=encodeURIComponent(a+"?path=solid_payments_deposit_failed")),o.getDepositUrl(n).then((function(e){t(h,{depositHref:e.data})})).catch((function(e){t(m)}))},getAccountById:function(e){return i.find(this.get("allAccounts"),(function(t){return t.accountId===e}))},getAtmAmount:function(){var e=this.get("atmAmount");return-1===e?"Other":i.isUndefined(e)?"N/A":e},isBonusApplied:function(){return!0===this.get("bonusApplied")},choseDepositAmount:function(){return i.isNaN(this.getAmount())||-1===this.getAmount()?this.getDefaultAmount():this.getAmount()},getAmount:function(){return this.get("amount")},getAmountConfig:function(){return this.get("amountConfig")},getDefaultAmount:function(){var e=this.getAmountConfig();return e&&e.defaultAmount}})}.call(t,a,t,e))||(e.exports=r)}).call(this,a(1))},2745:function(e,t){e.exports="<div class=deposit-popup> <div class=deposit-form></div> <form id=deposit-frame-form target=deposit-frame method=POST></form> <iframe id=deposit-frame name=deposit-frame style=visibility:hidden></iframe> </div> "},2746:function(e,t,a){(function(n,r){var i;void 0===(i=function(e,t,n){var r=a(1),i=a(21),o=a(97),s=a(2747),d=a(165),l=a(585),c=a(586),u=a(16),f=a(7),m=r.template(a(2748)),h=a(2),p=h.ERROR,v=h.SUCCESS,g=i.extend({className:"metatrader-bonuses",events:function(){return r.extend({},r.result(i.prototype,"events"),{"click .fn-tab":"changeTab"})},initialize:function(e){i.prototype.initialize.apply(this,arguments),this.model=new s,r.isEmpty(e.model.get("bonusesTab"))||this.model.setCurrentTabById(e.model.get("bonusesTab")),this.listenTo(this.model,"change:selectedAccountBonusesStatus",this.loadCompleted),this.listenTo(this.model,"change:currentTabId",this.updateTab),this.listenTo(this,"form:bonusesForm:change:field_platformAccountId",this.changeAccount)},loadCompleted:function(){var e=this.model.get("selectedAccountBonusesStatus");if(e===p)return this.loadError();e===v&&(this.removeChildView(".metatrader-bonuses"),this.showTemplate())},loadError:function(){this.removeChildView(".metatrader-bonuses"),f.trigger("ui:message-box",{parent:document.body,text:__("server.request.generic.error.body",__("link.contact_us"))})},showTemplate:function(){var e=this;this.$el.html(m({model:this.model.toJSON()})),this.updateTab();var t=this.$el.find(".bonuses-form"),a=this.model.get("metaTraderAccounts"),n=r.find(a,(function(t){return t.platformAccountId===e.model.get("selectedAccountId")})).platformAccountId,i={form:[[{disable:!1,template:d.selectBox,title:__("metatrader.bonuses.account")+":",name:"field_platformAccountId",savedData:n,options:a,transformOptionsValue:function(e){return e.platformAccountId},transformOptionText:function(e){var t=e.accountId,a=e.tradePlatformType,n=e.currency;return a+" Trader - "+t+" - "+String(n).toUpperCase()},translationKey:""}]]},o=new c(i);for(var s in this.formView=new l({model:o,$parent:t}),this.formView.show(),this.formView.form._fields){var u=this.formView.form._fields[s];this.listenTo(u,"all",(function(t,a,n){e.trigger("form:bonusesForm:"+t+":"+a._name,a,n)}))}return this},updateTab:function(){var e=this.model,t=__currency(r.find(e.get("metaTraderAccounts"),{platformAccountId:e.get("selectedAccountId")}).currency),a=this.model.getCurrentTabData(),n=a.view,i=a.model;this.addChildView(".tab-content",n,{model:new i({bonuses:e.getBonuses(),accountCurrency:t})}),this.$(".header-container-xs .caption").html(__(this.model.getCurrentTabName())),this.$(".tab").removeClass("active");var o=this.model.getCurrentTabId();this.$(".tab[data-tab-id="+o+"]").addClass("active")},changeTab:function(e){this.model.setCurrentTabById(u(e.currentTarget).attr("data-tab-id"))},changeAccount:function(e){var t=this.formView.form.getField("field_platformAccountId").value();this.model.loadMetaTraderBonusesForAccount(t),this.addChildView(".metatrader-bonuses",o,{parent:this.$el,translucent:"2"})},render:function(){return i.prototype.render.apply(this,arguments),this.addChildView(".metatrader-bonuses",o,{parent:this.$el,translucent:"2"}),this}});n.exports=g}.call(t,a,t,e))||(e.exports=i)}).call(this,a(1),a(16))},2747:function(e,t,a){(function(n){var r;void 0===(r=function(e,t,n){var r=a(897),i=a(2501),o=a(2503),s=a(2504),d=a(2505),l=a(1),c=a(2).EMPTY;n.exports=r.extend({defaults:function(){return{tabs:[{id:"in-progress",name:__("bonus.tab.in_progress"),viewClass:i,modelClass:s},{id:"completed",name:__("bonus.tab.completed"),viewClass:o,modelClass:d}],currentTabId:"in-progress",defaultTabId:"in-progress",selectedAccountId:c,selectedAccountBonuses:[],statusOfMetaTraderAccountsWithBonuses:c,metaTraderAccounts:[]}},initialize:function(){var e=this;r.prototype.initialize.apply(this,arguments),this.loadMetaTraderAccountsWithBonuses().then((function(){var t=l.first(e.get("metaTraderAccounts")).platformAccountId;e.set("selectedAccountId",t),e.loadMetaTraderBonus(t)}))},loadMetaTraderBonusesForAccount:function(e){this.set("selectedAccountId",e),this.loadMetaTraderBonus(e)},getCurrentTab:function(){return l.findWhere(this.get("tabs"),{id:this.getCurrentTabId()})},getCurrentTabData:function(){var e=this.getCurrentTab();return{view:e.viewClass,model:e.modelClass}},getCurrentTabId:function(){var e=this.get("currentTabId");return e||this.get("defaultTabId")},getCurrentTabName:function(){return this.getCurrentTab().name},getBonuses:function(){return this.get("selectedAccountBonuses")},setCurrentTabById:function(e){var t=this.getTabById(e);return t&&this.set({currentTabId:t.id,currentTabName:t.name}),t},getTabById:function(e){return l.findWhere(this.get("tabs"),{id:e})}})}.call(t,a,t,e))||(e.exports=r)}).call(this,a(1))},2748:function(e,t){e.exports='<div class=bonuses> <div class=bonuses-form></div> <div class="visible-xs header-container-xs"> <div class="left flex fn-close-popup flex-valign-center btn"> <div class="icon arrow"></div> <b><%-__(\'actions.back\') %></b> </div> <div class="caption flex flex-valign-center flex-align-center"> <%-model.currentTabName || model.currentTabNameMobile%> </div> <div class="right flex flex-valign-center btn"></div> </div> <div class=bonus-progress-content> <div class=modal-dialog-container></div> <div class="bonuses_tabs flex flex-row flex-align-start hidden-xs"> <% _.each(model.tabs, function(v) { %> <div class="tab fn-tab flex flex-stretch flex-valign-center active <%- model.currentTabId == v.id ? \'active\' : \'\' %>" data-tab-id="<%- v.id %>"><%- v.name %></div> <% }) %> </div> <div class=tab-content></div> </div> </div> '}}]);