(window.webpackJsonp=window.webpackJsonp||[]).push([[64],{2169:function(e,t,n){"use strict";n.r(t);var i=n(0),a=n.n(i),r=n(1),s=n.n(r),o=n(56),l=n(13),c=n.n(l),d=n(2452),h=n(8),u=n.n(h),v=n(74),m=n(39),g=n(100),p=n(12),f=n.n(p),y=n(1200),b=n(81),_=n.n(b),E=n(2562),w=n(10),C=n.n(w),O=n(2271),S=n(2577),T=n(61),I=n(2563),W=n(2564),L=n(31),k=n.n(L),j=n(11),N=n.n(j),D=n(57),x=n(2565),P=n.n(x),A=(n(2566),n(2453)),z=n(2567),M=n(2),Y=n(7),V=n.n(Y),R=n(110),B=n(4),U=n(104),H=n.n(U),J=n(64),F=n.n(J),G=n(3),K=n(999),q=Object(G.a)([function(e){return e.tradingCentral},function(e,t,n){return t},function(e,t,n){return n}],(function(e,t,n){return e[Object(K.a)(t,n)]})),Q=Object(G.a)([q],(function(e){return e&&e.status})),X=Object(G.a)([q],(function(e){return e&&e.data})),Z=n(2454),$=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],i=!0,a=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(i=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);i=!0);}catch(e){a=!0,r=e}finally{try{!i&&o.return&&o.return()}finally{if(a)throw r}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},ee=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();function te(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ne=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),ee(t,[{key:"formatLegendLine",value:function(e,t){return F()(__(e),{preprocessNodes:function(e){return s.a.each(e,(function(e){"span"===e.name&&e.children&&(e.attribs={style:"color:"+t})})),e}})}},{key:"render",value:function(){var e=this.props.status;if(!e)return null;switch(e){case M.LOADING:var t=u()(te({"chart-trading-central tc":!0,"tc-loading":!0},this.props.className,!!this.props.className));return a.a.createElement("div",{className:t},a.a.createElement("div",{className:"tc-wrapper"},a.a.createElement(Z.a,null)));case M.ERROR:var n=u()(te({"chart-trading-central tc":!0,"tc-instrument-unavailable":!0},this.props.className,!!this.props.className));return a.a.createElement("div",{className:n},a.a.createElement("div",{className:"tc-wrapper"},__("trading.central.unavailable.description")));case M.SUCCESS:var i=this.props,r=i.data,o=i.settings,l=r.title,c=r.date,d=r.hour,h=r.paragraphs,v=r.term,m=r.pivot,g=r.resistance1,p=r.support1,f=$(o.lines,3),y=$(f[0].colors,1)[0],b=$(f[1].colors,1)[0],_=$(f[2].colors,1)[0],E=__("trading.central.preference.title")+" "+__("trading.central.term."+v.toLowerCase());m===g?E+=" "+__("trading.central.preference.decline"):m===p&&(E+=" "+__("trading.central.preference.rise"));var w=H.a.user.applyOffset(""+c+d,"YYYYMMDDHH:mm","DD/MM/YYYY HH:mm")+" ("+H.a.user.GMTPostfix()+")",C=u()(te({"chart-trading-central tc":!0},this.props.className,!!this.props.className));return a.a.createElement("div",{className:C},a.a.createElement("div",{className:"tc-wrapper"},a.a.createElement("div",{className:"tc-info"},a.a.createElement("div",{className:"tc-header"},E),a.a.createElement("div",null,l),s.a.map(h,(function(e,t){return a.a.createElement("div",{key:"tc-p-"+t},e)})),a.a.createElement("div",null,w)),a.a.createElement("div",{className:"tc-legend-full"},a.a.createElement("div",{className:"tc-header"},F()(__("trading.central.study.legend"))),a.a.createElement("div",{className:"tc-resistance"},this.formatLegendLine("trading.central.lines.extended.resistance",y)),a.a.createElement("div",{className:"tc-support"},this.formatLegendLine("trading.central.lines.extended.support",b)),a.a.createElement("div",{className:"tc-pivot"},this.formatLegendLine("trading.central.lines.extended.pivot",_)))))}}}]),t}(a.a.Component),ie=Object(B.connect)((function(e,t){var n=t.symbol,i=t.term;return{data:X(e,n,i),status:Q(e,n,i),settings:C.a.getUserCommonData().getTradingCentralSettings()}}))(ne),ae=n(2578),re=n(1195),se=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},oe=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();function le(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var ce=500,de=[ae.a];W.widget.prototype.documentElement=function(){return this._innerWindow().document.documentElement},W.widget.prototype.forEachChart=function(e){for(var t=0,n=this.chartsCount();t<n;t++)e(this.chart(t),t)};var he=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return c()(n),n.save=r.debounce(n.save,1e3),n.state={ready:!1,minimized:v.default.mobile()&&v.default.portrait()&&window.innerHeight<ce,sidebarCollapsed:!1},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),oe(t,[{key:"componentDidMount",value:function(){this._mounted=!0,this.symbol=this.props.symbol||t.getSelectedInstrumentSymbol();var e=this.props,n=e.client_id,i=e.user_id;N.a.getTradingViewSavedCharts(n,i).then(this.onSavedChartsLoaded).catch(this.onSavedChartsLoaded)}},{key:"onSavedChartsLoaded",value:function(e){var n=e.data,i=e.status;if(this.serverError=200!==i,this.serverError){var a=localStorage.getItem("tv_local");a?this.onSavedChartLoaded(t.prepareLocalSavedChart(a)):this.initTradingViewWidget()}else if(n.data&&0!==n.data.length){var s=r.chain(n.data).filter((function(e){return 0===e.name.indexOf("main")})).sortBy("timestamp").value();if(r.isEmpty(s))this.initTradingViewWidget();else{var o=this.props,l=o.client_id,c=o.user_id;r.each(r.initial(s),(function(e){return N.a.deleteTradingViewSavedChart(l,c,e.id)})),N.a.getTradingViewSavedChart(l,c,r.last(s).id).then(this.onSavedChartLoaded)}}else this.initTradingViewWidget()}},{key:"onSavedChartLoaded",value:function(e){var n=e.data.data,i=n.id,a=n.name,r=n.content;try{var s=JSON.parse(r),o=JSON.parse(s.content);f.a.isChartTradingViewMultichartsEnabled()||(o.layout="s");for(var l=o.charts,c=l.length-1;c>=0;c--){var d=l[c];delete d.timezone;for(var h=d.panes,u=h.length-1;u>=0;u--){for(var v=h[u],m=v.sources,g=m.length-1;g>=0;g--){var p=m[g];if("MainSeries"===p.type&&(p.state.symbol=this.symbol,0===c)){var y=t.getDeepLinkInterval();y&&(p.state.interval=y),O.f[p.state.interval]||(p.state.interval=this.props.interval)}de.indexOf(p.state.description)>=0&&m.splice(g,1)}v.sources.length||h.splice(u,1)}}this.initTradingViewWidget(i,a.split("_")[1],o)}catch(e){this.initTradingViewWidget()}}},{key:"initTradingViewWidget",value:function(e,n,i,a){var s=this;this._mounted&&(this.chartId=e,this.theme=_.a.isLightTheme()?O.i.LIGHT:O.i.DARK,this.themeChanged=n!==this.theme,this.tvDatafeed=new E.b,this.tvDatafeed.on(E.a.LOAD,this.onDataLoaded),this.tvWidget=new W.widget(se({},this.props,{symbol:this.symbol,container_id:this.refs.tvWidget.id,datafeed:this.tvDatafeed,theme:this.theme,overrides:se({},O.d[this.theme],a&&{"mainSeriesProperties.style":a}),studies_overrides:O.g[this.theme],loading_screen:{backgroundColor:O.b[this.theme]}},m.default.mobile()&&{disabled_features:[].concat(le(this.props.disabled_features),le(O.a.MOBILE.DISABLED))},f.a.isChartTradingViewMultichartsEnabled()&&{enabled_features:[].concat(le(this.props.enabled_features),["header_layouttoggle","support_multicharts"])},i&&{saved_data:i},!i&&{interval:t.getDeepLinkInterval()||this.props.interval})),this.tvTradingCentral=new ae.b(this.tvWidget),this.tvEventsListener=d.a.create({onThemeChanged:function(e){s.theme=e,s.changeTheme(e),r.each(s.positions,(function(t){return t.changeTheme(e)})),r.each(s.orders,(function(t){return t.changeTheme(e)}))},onInstrumentRowSelected:function(e){s.state.ready?e!==s.symbol&&s.setSymbol(e):s.tempSymbol=e}}),this.tvEventsListener.listenTo(V.a,re.TC_SETTINGS_UPDATE_EVENT,this.onTradingCentralStatusChanged),this.tvWidget.onChartReady(this.onChartReady))}},{key:"setSymbol",value:function(e){var t=this;this.symbol=e,this.removeTradings(this.getInstrument()),this.removeTradingCentral(),this.tvWidget.forEachChart((function(n){return n.setSymbol(e,(function(){return t.save()}))}))}},{key:"onDataLoaded",value:function(e,t,n){var i=this;if(t===this.symbol){var a=this.tvDatafeed.getSubscription(t,n).getInstrument();this.tvWidget.forEachChart((function(e,t){e.resolution()===n&&(i.initTradings(a,e),0===t&&i.initTradingCentral(a,n,e))}))}}},{key:"onChartReady",value:function(){var e=this,t=this.tvWidget.documentElement(),n=this.tvWidget.chart();Object(O.l)(this.tvWidget,"main-chart"),Object(O.m)(this.tvWidget),Object(O.n)(this.tvWidget),this.themeChanged&&this.changeTheme(this.theme),Object(O.k)(t),this.updateIntervalDropdown(),m.default.mobile()&&(Object(O.j)(t),this.initOrientationHandler()),this.chartId&&(this.tvWidget._innerAPI()._chartWidgetCollection.metaInfo.id.setValue(this.chartId),this.tvWidget._innerAPI()._chartWidgetCollection.metaInfo.uid.setValue(this.chartId),this.tvWidget._innerAPI()._chartWidgetCollection.metaInfo.name.setValue("main")),this.tvWidget.onContextMenu(this.onContextMenu),this.setState({ready:!0}),Object(I.b)(store.getState(),!0)===A.b.INDICATORS&&t.querySelector("#header-toolbar-indicators").click(),this.tvWidget.subscribe("onAutoSaveNeeded",(function(){e.save()})),n.onSymbolChanged().subscribe(null,(function(){e.save()})),n.onIntervalChanged().subscribe(null,(function(){e.save(),e.updateIntervalDropdown()})),this.tvWidget.subscribe("toggle_sidebar",(function(t){e.setState({sidebarCollapsed:t})})),this.tvWidget.subscribe("layout_changed",(function(){Object(O.m)(e.tvWidget),Object(O.n)(e.tvWidget),e.removeTradings(e.getInstrument()),e.tvWidget.forEachChart((function(t,n){t.dataReady((function(){return e.initTradings(e.getInstrument(),t)})),n>0&&e.tvTradingCentral.remove(t)}))})),this.tempSymbol&&(this.setSymbol(this.tempSymbol),delete this.tempSymbol)}},{key:"getInstrument",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.tvWidget.symbolInterval().symbol;return k.a.getInstrumentBySymbol(e)}},{key:"onContextMenu",value:function(e,n){if(n){var i=this.tvWidget.symbolInterval(),a=i.symbol,r=i.interval,s=this.tvDatafeed.getSubscription(a,r);if(s){var o=s.getLastCandle().close,l=s.getInstrument(),c=l.getDisplayName(),d=l.getPrecision(),h=n.toFixed(d),u=[],v=Object(D.isBuyTradable)(a),m=Object(D.isSellTradable)(a);return+h<o?(v&&u.push({position:"top",text:__("actions.buy")+" "+c+" "+__("type.LIMIT")+" "+h,click:function(){t.trade(a,{direction:M.BUY,type:R.TYPE_LIMIT,entry:h})}}),m&&u.push({position:"top",text:__("actions.sell")+" "+c+" "+__("type.STOP")+" "+h,click:function(){t.trade(a,{direction:M.SELL,type:R.TYPE_STOP,entry:h})}})):+h>o&&(m&&u.push({position:"top",text:__("actions.sell")+" "+c+" "+__("type.LIMIT")+" "+h,click:function(){t.trade(a,{direction:M.SELL,type:R.TYPE_LIMIT,entry:h})}}),v&&u.push({position:"top",text:__("actions.buy")+" "+c+" "+__("type.STOP")+" "+h,click:function(){t.trade(a,{direction:M.BUY,type:R.TYPE_STOP,entry:h})}})),v&&u.push({position:"top",text:__("actions.buy")+" "+c+" "+__("type.MARKET"),click:function(){t.trade(a,{direction:M.BUY})}}),m&&u.push({position:"top",text:__("actions.sell")+" "+c+" "+__("type.MARKET"),click:function(){t.trade(a,{direction:M.SELL})}}),u.length>0&&u.push({text:"-",position:"top"}),u}}}},{key:"updateIntervalDropdown",value:function(){this.setState({period:O.f[this.tvWidget.symbolInterval().interval]})}},{key:"onOrientationChanged",value:function(){v.default.portrait()?this.tvWidget.documentElement().classList.replace("mobile-portrait","mobile-landscape"):this.tvWidget.documentElement().classList.replace("mobile-landscape","mobile-portrait")}},{key:"initOrientationHandler",value:function(){var e=this.onOrientationChanged,t=Object.prototype.hasOwnProperty.call(window,"onorientationchange")?"orientationchange":"resize";window.addEventListener?window.addEventListener(t,e,!1):window.attachEvent?window.attachEvent(t,e):window[t]=e,this.tvWidget.documentElement().classList.add(v.default.landscape()?"mobile-landscape":"mobile-portrait")}},{key:"save",value:function(){var e=this;this.tvWidget&&(this.serverError?this.tvWidget.save((function(t){localStorage.setItem("tv_local",JSON.stringify({name:e.getChartName(),content:JSON.stringify({content:JSON.stringify(t)})}))})):this.tvWidget.saveChartToServer((function(){}),(function(){}),!1,{chartName:this.getChartName()}))}},{key:"getChartName",value:function(){return"main_"+this.theme}},{key:"changeTheme",value:function(e){this.tvWidget.changeTheme(e),this.tvWidget.applyOverrides(O.d[e]),this.tvWidget.applyStudiesOverrides(O.g[e])}},{key:"componentWillUnmount",value:function(){this._mounted=!1,this.tvEventsListener&&(this.tvEventsListener.destroy(),this.tvEventsListener=null),this.tvDatafeed&&(this.tvDatafeed.destroy(),this.tvDatafeed=null),this.tvTradingCentral&&(this.tvTradingCentral.destroy(),this.tvTradingCentral=null),r.each(this.positions,(function(e){return e.remove()})),r.each(this.orders,(function(e){return e.remove()})),this.tvWidget&&(this.tvWidget._getIFrameElement()&&!this.tvWidget._getIFrameElement().contentWindow.ChartApiInstance&&(this.tvWidget._getIFrameElement().contentWindow.ChartApiInstance={destroy:function(){}}),this.tvWidget._getIFrameElement()&&!this.tvWidget._getIFrameElement().contentWindow.destroyChart&&(this.tvWidget._getIFrameElement().contentWindow.destroyChart=function(){}),this.tvWidget.remove(),this.tvWidget=null)}},{key:"minimize",value:function(){this.setState({minimized:!0})}},{key:"restoreSize",value:function(){this.setState({minimized:!1})}},{key:"changeInterval",value:function(e){this.tvWidget.setSymbol(this.tvWidget.symbolInterval().symbol,O.e[e])}},{key:"render",value:function(){var e,t,n,i=this.state,s=i.ready,o=i.minimized,l=i.period,c=i.sidebarCollapsed,d=i.tradingCentral,h=this.props,v=h.height,p=h.className,f=u()((n=!!p,(t=p)in(e={"chart-box":!0,"chart-trading-view":!0,minimized:o})?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e)),y={};return v&&(y={height:v+"px",minHeight:v+"px",maxHeight:v+"px"}),a.a.createElement("div",{className:f,style:y},a.a.createElement("div",{className:"chart-trading-view-wrapper"},!s&&a.a.createElement(Z.a,null),m.default.mobile()&&[a.a.createElement("div",{className:"minimize-chart hidden-minimized hidden-landscape",key:"minimize-chart",onClick:this.minimize},a.a.createElement("i",{className:"icon-double-arrow-down "})),a.a.createElement(g.a,{className:"change-interval hidden-minimized hidden-landscape",as:"div",name:"chart-interval",key:"chart-interval",selected:l,transformOptionText:function(e){return e},options:r.keys(O.e),onChange:this.changeInterval}),a.a.createElement("div",{className:"restore-size-chart visible-minimized hidden-landscape",key:"restore-size-chart",onClick:this.restoreSize},a.a.createElement("div",null,a.a.createElement("i",{className:"icon-double-arrow-up"})))],a.a.createElement("div",{id:r.uniqueId("chart-trading-view-"),ref:"tvWidget",className:"chart-trading-view-container hidden-minimized"}),Object(ae.c)()&&d&&a.a.createElement(ie,{className:c?"":"with-sidebar",symbol:d.symbol,term:d.term})))}},{key:"initTradings",value:function(e,t){var n=this;f.a.isChartTradingViewTradingLinesEnabled()&&(this.tvEventsListener.listenTo(e.getPositions(),"add",(function(i){n.positions.push(Object(z.b)(t,e,i,n.theme))})),this.tvEventsListener.listenTo(e.getOrders(),"add",(function(i){n.orders.push(Object(z.a)(t,e,i,n.theme))})),this.initPositions(e,t),this.initOrders(e,t))}},{key:"removeTradings",value:function(e){this.tvEventsListener.stopListening(e.getPositions(),"add"),this.tvEventsListener.stopListening(e.getOrders(),"add"),r.each(this.positions,(function(e){return e.remove()})),r.each(this.orders,(function(e){return e.remove()}))}},{key:"initOrders",value:function(e,t){var n=this;this.orders||(this.orders=[]),r.each(e.getOrders().models,(function(i){n.orders.push(Object(z.a)(t,e,i,n.theme))}))}},{key:"initPositions",value:function(e,t){var n=this;this.positions||(this.positions=[]),r.each(e.getPositions().models,(function(i){n.positions.push(Object(z.b)(t,e,i,n.theme))}))}},{key:"onTradingCentralStatusChanged",value:function(){var e=C.a.getUserCommonData().isTradingCentralEnabled();!this.tvTradingCentral.enabled&&e?this.initTradingCentral():this.tvTradingCentral.enabled&&!e&&this.removeTradingCentral(),Object(O.n)(this.tvWidget)}},{key:"initTradingCentral",value:function(e,t){e&&t||(t=this.tvWidget.symbolInterval().interval,e=this.tvDatafeed.getSubscription(this.tvWidget.symbolInterval().symbol,t).getInstrument()),this.tvTradingCentral.init(e,t),this.setState({tradingCentral:this.tvTradingCentral.options})}},{key:"removeTradingCentral",value:function(){this.tvTradingCentral.destroy(),this.setState({tradingCentral:void 0})}}],[{key:"getSelectedInstrumentSymbol",value:function(){return Object(T.getUiSelectedInstrumentCategorySymbol)(store.getState())}},{key:"getDeepLinkInterval",value:function(){if(Object(I.b)(store.getState(),!0)===A.b.DETAILS){var e=Object(I.a)(store.getState());if(e)return O.e[e.toLowerCase()]}}},{key:"prepareLocalSavedChart",value:function(e){var t=JSON.parse(e);return t.name?{data:{data:t}}:{data:{data:{name:"",content:JSON.stringify({content:e})}}}}},{key:"trade",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.direction===M.BUY&&Object(D.isBuyTradable)(e)?V.a.trigger("ui:new-position",se({symbolOrId:e},t)):t.direction===M.SELL&&Object(D.isSellTradable)(e)&&V.a.trigger("ui:new-position",se({symbolOrId:e},t))}}]),t}(a.a.Component);he.defaultProps={autosize:!0,disabled_features:O.a.DISABLED,enabled_features:O.a.ENABLED,interval:"5",library_path:"tv/",locale:o.getCurrentLanguage()||"en",charts_storage_url:N.a.tradingViewService(),client_id:Object(y.default)(f.a.getBrandName()),user_id:Object(y.default)(C.a.getCustomerId()),charts_storage_api_version:"1.1",auto_save_delay:1,link_to_tradingview:!1,timezone:Object(S.a)(C.a.getUserCommonData().getUserTimezoneObject()),custom_css_url:""+window.location.origin+window.location.pathname+"/"+P.a,time_frames:[{text:"1d",resolution:"1",description:"1 Day"},{text:"5d",resolution:"5",description:"5 Days"},{text:"1m",resolution:"30",description:"1 Month"},{text:"3m",resolution:"60",description:"3 Months"},{text:"6m",resolution:"120",description:"6 Months"},{text:"1y",resolution:"D",description:"1 Year"},{text:"5y",resolution:"W",description:"5 Years"}]};t.default=he}}]);